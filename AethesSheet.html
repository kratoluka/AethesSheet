<div class="sheet-master">

<input type="hidden" class="sheet-tabstoggle" name="attr_sheetTab"/>
<div class="sheet-Tabs sheet-block">
    <button type="action" name="act_overview">Overview</button>
    <button type="action" name="act_stats">Stats</button>
    <button type="action" name="act_perks">Perks</button>
    <button type="action" name="act_weapons">Weapons</button>
    <button type="action" name="act_rune-spells">Rune Spells</button>
    <button type="action" name="act_invocation">Invocation</button>
    <button type="action" name="act_inventory">Inventory</button>
    <button type="action" name="act_equipment">Character</button>
</div>

<div class="sheet-overview">
    <div class="sheet-overview-Headpiece sheet-block">
        <img class="headpiece-img" name="attr_character_avatar">
        <input class="headpiece-name" type="text" name="attr_character_name" readonly/>
    </div>
    <div class="sheet-overview-Race sheet-block">
        <div class="attribute-Row-RaceL">
            <h2> Race </h2></div>
        <div class="attribute-Row-Race">
            <input type="text" name="attr_race" value="" readonly/>
        </div>
        <div class="attribute-Row-LevelL">
            <h2> Level </h2></div>
        <div class="attribute-Row-Level">
            <input type="number" name="attr_level" value="1" readonly/>
        </div>
    </div>
    <div class="sheet-overview-Attributes sheet-block">

        <div class="attribute-Row attribute-Row-Title">
            <div class="attribute-Row-Name">
                <h2> Attributes </h2>
            </div>
            <div class="attribute-Row-Value">
                <input type="hidden" class="attribute-mode" name="attr_attributeMode"/>
                <button type="action" class="attribute-mode-normal" name="act_attributeadvantage">Normal</button>
                <button type="action" class="attribute-mode-advantage" name="act_attributedisadvantage">Advantage</button>
                <button type="action" class="attribute-mode-disadvantage" name="act_attributenormal">Disadvantage</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Vigour">
            <div class="attribute-Row-Name">
                <p> Vigour </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Vigour" value="1" min="1" readonly/>
                <button type="action" name="act_rollVigour">✍️</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Endurance">
            <div class="attribute-Row-Name">
                <p> Endurance </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Endurance" value="1" min="1" readonly/>
                <button type="action" name="act_rollEndurance">✍️</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Intelligence">
            <div class="attribute-Row-Name">
                <p> Intelligence </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Intelligence" value="1" min="1" readonly/>
                <button type="action" name="act_rollIntelligence">✍️</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Strength">
            <div class="attribute-Row-Name">
                <p> Strength </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Strength" value="1" min="1" readonly/>
                <button type="action" name="act_rollStrength">✍️</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Dexterity">
            <div class="attribute-Row-Name">
                <p> Dexterity </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Dexterity" value="1" min="1" readonly/>
                <button type="action" name="act_rollDexterity">✍️</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Perception">
            <div class="attribute-Row-Name">
                <p> Perception </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Perception" value="1" min="1" readonly/>
                <button type="action" name="act_rollPerception">✍️</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Arcana">
            <div class="attribute-Row-Name">
                <p> Arcana </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Arcana" value="1" min="1" readonly/>
                <button type="action" name="act_rollArcana">✍️</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Faith">
            <div class="attribute-Row-Name">
                <p> Faith </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Faith" value="1" min="1" readonly/>
                <button type="action" name="act_rollFaith">✍️</button>
                <button type="action" name="act_rollFortune">&#x1F36A;</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Nature">
            <div class="attribute-Row-Name">
                <p> Nature </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Nature" value="1" min="1" readonly/>
                <button type="action" name="act_rollNature">✍️</button>
            </div>
        </div>
        <div class="attribute-Row attribute-Row-Charisma">
            <div class="attribute-Row-Name">
                <p> Charisma </p>
            </div>
            <div class="attribute-Row-Value">
                <input type="number" name="attr_Charisma" value="1" min="1" readonly/>
                <button type="action" name="act_rollCharisma">✍️</button>
                <button type="action" name="act_rollFortune">&#x1F36A;</button>
            </div>
        </div>
    </div>
    <div class="sheet-overview-State sheet-block">
        <div class="state-Row-Title">
            <h2>State</h2>
        </div>

        <div class="state-Row state-Row-Health">
            <div class="state-Row-Name">
                <p> Health: </p>
            </div>
            <div class="state-Row-Value">
                <input type="number" value="0" name="attr_hp" step="any"/>
                <text> /</text>
                <input type="number" value="10" name="attr_hp_max" readonly/>
            </div>
        </div>

        <div class="state-Row state-Row-Barrier">
            <div class="state-Row-Name">
                <p> Barrier: </p>
            </div>
            <div class="state-Row-Value">
                <input type="number" value="0" name="attr_barrier" step="any"/>
                <text> /</text>
                <input type="number" value="10" name="attr_barrier_max"/>
            </div>
        </div>

        <div class="state-Row state-Row-Vitality">
            <div class="state-Row-Name">
                <p> Vitality: </p>
            </div>
            <div class="state-Row-Value">
                <input type="number" value="0" name="attr_vitality" step="any"/>
                <text> /</text>
                <input type="number" value="10" name="attr_vitality_max" readonly/>
            </div>
        </div>

        <div class="state-Row state-Row-Focus">
            <div class="state-Row-Name">
                <p> Focus: </p>
            </div>
            <div class="state-Row-Value">
                <input type="number" value="0" name="attr_fp" step="any"/>
                <text> /</text>
                <input type="number" value="10" name="attr_fp_max" readonly/>
            </div>
        </div>

        <div class="state-Row state-Row-Stamina">
            <div class="state-Row-Name">
                <p> Stamina: </p>
            </div>
            <div class="state-Row-Value">
                <input type="number" value="0" name="attr_sp" step="any"/>
                <text> /</text>
                <input type="number" value="10" name="attr_sp_max" readonly/>
            </div>
        </div>
        <div class="state-Row state-Row-Space">&nbsp;</div>
        <div class="state-Row-Rest">
            <button type="action" name="act_rest">Rest</button>
        </div>
    </div>
    <div class="sheet-overview-Stats sheet-block">
        <div class="stats-Row-Title">
            <h2>Stats</h2>
        </div>
        <div class="stats-Row stats-Row-Initiative">
            <div class="stats-Row-Name">
                <p> Initiative </p>
            </div>
            <div class="stats-Row-Value">
                <input type="number" name="attr_initiative_total" value="1" readonly/>
            </div>
        </div>
        <div class="stats-Row stats-Row-Evasion">
            <div class="stats-Row-Name">
                <p> Evasion </p>
            </div>
            <div class="stats-Row-Value">
                <input type="number" name="attr_evasion_total" value="1" readonly/>
            </div>
        </div>
        <div class="stats-Row stats-Row-Speed">
            <div class="stats-Row-Name">
                <p> Speed </p>
            </div>
            <div class="stats-Row-Value">
                <input type="number" name="attr_speed_total" value="1" readonly/>
            </div>
        </div>
        <div class="stats-Row stats-Row-EquipLoad">
            <div class="stats-Row-Name">
                <p> Equip Load: </p>
            </div>
            <div class="stats-Row-Value">
                <input type="number" value="0" name="attr_equip_load"/>
                <text> /</text>
                <input type="number" value="1" name="attr_equip_load_max" readonly/>
            </div>
        </div>
        <div class="stats-Row stats-Row-Physical">
            <div class="stats-Row-Name">
                <p> Physical Resist </p>
            </div>
            <div class="stats-Row-Value">
        <input type="number" name="attr_phys_resist_total" value="0" readonly/>
            </div>
        </div>
        <div class="stats-Row stats-Row-Magical">
            <div class="stats-Row-Name">
                <p> Magical Resist </p>
            </div>
            <div class="stats-Row-Value">
        <input type="number" name="attr_mag_resist_total" value="0" readonly/>
            </div>
        </div>
        <div class="stats-Row stats-Row-Resistant">
            <div class="stats-Row-Name">
                <p> Resistant to </p>
            </div>
            <div class="stats-Row-Value">
                <fieldset class="repeating_resistance">
                    <input type="text" name="attr_resistance" readonly/>
                </fieldset>
            </div>
        </div>
        <div class="stats-Row stats-Row-Space">&nbsp;</div>
        <div class="stats-Row-TakeDamage">
            <input type="hidden" class="prompt-take-damage" name="attr_promptTakeDamage"/>
            <button type="action" class="prompt-take-damage-button" name="act_promptTakeDamage"> Take Damage </button>
            <div class="prompt-background">
                <input type="hidden" class="sheet-prompt" name="attr_promptAttack"/>
                <div class="prompt-damage">
                    <div class="prompt-damage-Title">
                        Take Damage
                    </div>
                    <div class="prompt-damage-Close">
                        <button type="action" name="act_promptClose">Close</button>
                    </div>
                    <div class="prompt-damage-SlashingL">
                        Slashing
                    </div>
                    <div class="prompt-damage-Slashing">
                        <input type="number" name="attr_take_slashing" value="0"/>
                    </div>
                    <div class="prompt-damage-PiercingL">
                        Piercing
                    </div>
                    <div class="prompt-damage-Piercing">
                        <input type="number" name="attr_take_piercing" value="0"/>
                    </div>
                    <div class="prompt-damage-BludgeoningL">
                        Bludgeoning
                    </div>
                    <div class="prompt-damage-Bludgeoning">
                        <input type="number" name="attr_take_bludgeoning" value="0"/>
                    </div>
                    <div class="prompt-damage-FireL">
                        Fire
                    </div>
                    <div class="prompt-damage-Fire">
                        <input type="number" name="attr_take_fire" value="0"/>
                    </div>
                    <div class="prompt-damage-FrostL">
                        Frost
                    </div>
                    <div class="prompt-damage-Frost">
                        <input type="number" name="attr_take_frost" value="0"/>
                    </div>
                    <div class="prompt-damage-ShadowL">
                        Shadow
                    </div>
                    <div class="prompt-damage-Shadow">
                        <input type="number" name="attr_take_shadow" value="0"/>
                    </div>
                    <div class="prompt-damage-WaterL">
                        Water
                    </div>
                    <div class="prompt-damage-Water">
                        <input type="number" name="attr_take_water" value="0"/>
                    </div>
                    <div class="prompt-damage-PoisonL">
                        Poison
                    </div>
                    <div class="prompt-damage-Poison">
                        <input type="number" name="attr_take_poison" value="0"/>
                    </div>
                    <div class="prompt-damage-HP">
                        - <span name="attr_calc_take_damage"></span> HP
                    </div>
                    <div class="prompt-damage-Take">
                        <button type="action" name="act_promptTake">Take</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <div class="sheet-overview-Attacks sheet-block">
        <div class="attacks-Row-Title attacks-Row">
            <div class="attacks-Row-Name">
                <h2> Attacks </h2>
            </div>
            <div class="attacks-Row-Buttons">
                <input type="hidden" class="attack-mode" name="attr_attackMode"/>
                <button type="action" class="attack-mode-normal" name="act_attackadvantage">Normal</button>
                <button type="action" class="attack-mode-advantage" name="act_attackdisadvantage">Advantage</button>
                <button type="action" class="attack-mode-disadvantage" name="act_attacknormal">Disadvantage</button>
            </div>
        </div>
        <div class="attacks-Row-Attacks">
            <fieldset class="repeating_attacks" readonly>
                <div class="attacks-Row"> 
                    <div class="attacks-Row-Name">
                        <input type="text" name="attr_attack_name" readonly/>
                    </div>
                    <div class="attacks-Row-Buttons">
                        <input type="hidden" class="attack-one" name="attr_attack_one"/>
                        <button type="action" class="attack-button-one" name="act_attack-one">☝️</button>
                        <input type="hidden" class="attack-two" name="attr_attack_two"/>
                        <button type="action" class="attack-button-two" name="act_attack-two">✌️</button>
                    </div>
                </div>
                <!--hidden fields-->
                <input type="hidden" name="attr_attack_roll_dmg" value=""/>
                <button type="roll" name="roll_attack_dmg" style="display: none;" value="@{attack_roll_dmg}"></button>
                <input type="text" value="0" name="attr_attack_acc_bonus" readonly hidden/>
                <input type="text" value="0" name="attr_attack_dmg_bonus" readonly hidden/>
                <input type="text" value="5" name="attr_attack_crit_chance" readonly hidden/>
                <input type="text" value="" name="attr_attack_scaling" readonly hidden/>
                <input type="text" value="" name="attr_attack_dice_one" readonly hidden/>
                <input type="text" value="" name="attr_attack_type_one" readonly hidden/>
                <input type="text" value="" name="attr_attack_range_one" readonly hidden/>
                <input type="text" value="" name="attr_attack_dice_two" readonly hidden/>
                <input type="text" value="" name="attr_attack_type_two" readonly hidden/>
                <input type="text" value="" name="attr_attack_range_two" readonly hidden/>
                <input type="text" value="" name="attr_attack_dice_secondary" readonly hidden/>
                <input type="text" value="" name="attr_attack_type_secondary" readonly hidden/>
                <input type="text" value="" name="attr_attack_desc" readonly hidden/>
                <input type="checkbox" name="attr_attack_ranged" readonly hidden/>
                <input type="checkbox" name="attr_attack_spell" readonly hidden/>
            </fieldset>
        </div>
    </div>
    <div class="sheet-overview-Runes sheet-block">
        <div class="runes-Row-Title">
            <h2>Rune Spells</h2>
        </div>
        <div class="runes-MRow runes-Row-Memory">
            <div class="runes-Row-MTitle">
                <p> Memory </p>
            </div>
            <div class="runes-Row-MState">
                <input type="number" value="0" name="attr_rs_memory_used" readonly/>
                <text> /</text>
                <input type="number" value="3" name="attr_rs_memory" readonly/>
            </div>
        </div>
        <fieldset class="repeating_rune-spells">
            <div class="runes-Row">
                <div class="runes-Row-Name">
                    <input type="text" name="attr_rs_name" readonly/>
                </div>
                <div class="runes-Row-Check">
                    <input type="checkbox" name="attr_rs_ready"/>
                </div>
            </div>
        </fieldset>
    </div>
    <div class="sheet-overview-Invocations sheet-block">
        <h2>Invocation Spells</h2>
        <fieldset class="repeating_ic-saved">
            <input type="text" name="attr_ic_name" readonly/>
        </fieldset>
    </div>
    <div class="sheet-overview-Notes sheet-block">
        <p>Notes:</p><br>
        <textarea name="attr_notes"></textarea>
    </div>
    <div class="sheet-overview-Resources sheet-block">
        <div class="resources-Title">
            <h2>Resources</h2>
        </div>
        <div class="resources-Labels resources-Row">
            <div class="resources-Row-Name">
                <p>Name</p>
            </div>
            <div class="resources-Row-Amount">
                <p>Amount</p>
            </div>
            <div class="resources-Row-Total">
                <p>Total</p>
            </div>
            <div class="resources-Row-Note">
                <p>Note</p>
            </div>
        </div>
        <div class="resources-Block">
            <fieldset class="repeating_resources">
                <div class="resources-Row">
                    <div class="resources-Row-Name">
                        <input type="text" name="attr_resource_name"/>
                    </div>
                    <div class="resources-Row-Amount">
                        <input type="number" name="attr_resource_amount"/>
                    </div>
                    <div class="resources-Row-Total">
                        <input type="number" name="attr_resource_total"/>
                    </div>
                    <div class="resources-Row-Note">
                        <input type="text" name="attr_resource_note"/>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
</div>

<div class="sheet-stats">
    <div class="sheet-stats-Character sheet-block">
        <div class="stats-character-Row stats-character-Name">
            <div class="stats-character-Row-Title">
                <p> Name: </p>
            </div>
            <div class="stats-character-Row-Value">
                <input type="text" name="attr_character_name"/>
            </div>
        </div>
        <div class="stats-character-Row stats-character-Race">
            <div class="stats-character-Row-Title">
                <p> Race: </p>
            </div>
            <div class="stats-character-Row-Value">
                <select name="attr_race">
                    <option selected>Race</option>
                    <option value="Human">Human</option>
                    <option value="Half-Orc">Half-Orc</option>
                    <option value="Orc">Orc</option>
                    <option value="Seasonal Elf">Seasonal Elf</option>
                    <option value="Sun Elf">Sun Elf</option>
                    <option value="Moon Elf">Moon Elf</option>
                    <option value="Half-Elf">Half-Elf</option>
                    <option value="Dwarf">Dwarf</option>
                    <option value="Smallfolk">Smallfolk</option>
                    <option value="Felis">Felis</option>
                    <option value="Beast Chibiki">Beast Chibiki</option>
                    <option value="Merfolk">Merfolk</option>
                    <option value="Turtlefolk">Turtlefolk</option>
                    <option value="Demi-Giant">Demi-Giant</option>
                    <option value="Dragonkin">Dragonkin</option>
                    <option value="Djuri">Djuri</option>
                    <option value="Construct">Construct</option>
                    <option value="Changeling">Changeling</option>
                    <option value="Devilkin">Devilkin</option>
                </select>
            </div>
        </div>
    </div>
    <div class="sheet-stats-Attributes sheet-block">
        <div class="stats-attribute-Row-Title">
            <h2>Attributes</h2>
        </div>
        <div class="stats-attribute-Row-XP stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> XP Used: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" value="0" name="attr_xp_used" readonly/>
                <text> /</text>
                <input type="number" value="100" name="attr_xp" readonly/>
            </div>
        </div>
        <div class="stats-attribute-Row-Vigour stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Vigour: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Vigour" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Vigour_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-attribute-Row-Endurance stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Endurance: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Endurance" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Endurance_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-attribute-Row-Intelligence stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Intelligence: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Intelligence" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Intelligence_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-attribute-Row-Strength stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Strength: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Strength" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Strength_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-attribute-Row-Dexterity stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Dexterity: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Dexterity" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Dexterity_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-attribute-Row-Perception stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Perception: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Perception" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Perception_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-attribute-Row-Arcana stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Arcana: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Arcana" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Arcana_bonus" value="0"/>
            </div>
        </div>
        <br>
        <div class="stats-attribute-Row-Faith stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Faith: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Faith" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Faith_bonus" value="0"/>
            </div>
        </div>
        <br>
        <div class="stats-attribute-Row-Nature stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Nature: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Nature" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Nature_bonus" value="0"/>
            </div>
        </div>
        <br>
        <div class="stats-attribute-Row-Charisma stats-attribute-Row">
            <div class="stats-attribute-Row-Name">
                <p> Charisma: </p>
            </div>
            <div class="stats-attribute-Row-Value">
                <input type="number" name="attr_Charisma" value="1" min="1"/>
                <text>+</text>
                <input type="number" name="attr_Charisma_bonus" value="0"/>
            </div>
        </div>
    </div>
    <div class="sheet-stats-Stats sheet-block">
        <div class="stats-stats-Row-Title">
            <h2>Stats</h2>
        </div>

        <div class="stats-stats-Row-XP stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> XP: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" value="100" name="attr_xp"/>
                <text>Level</text>
                <input type="number" value="1" name="attr_level" readonly/>
            </div>
        </div>
        <div class="stats-stats-Row-Health stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Health: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" value="10" name="attr_hp_base" readonly/>
                <text>+</text>
                <input type="number" name="attr_hp_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-stats-Row-Vitality stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Vitality: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" value="1" name="attr_vitality_base" readonly/>
                <text>+</text>
                <input type="number" name="attr_vitality_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-stats-Row-Focus stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Focus: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" value="10" name="attr_fp_base" readonly/>
                <text>+</text>
                <input type="number" name="attr_focus_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-stats-Row-Stamina stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Stamina: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" value="1" name="attr_sp_base" readonly/>
                <text>+</text>
                <input type="number" name="attr_sp_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-stats-Row-Initiative stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Initiative: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" value="1" name="attr_initiative_base" readonly/>
                <text>+</text>
                <input type="number" name="attr_initiative_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-stats-Row-Evasion stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Evasion: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" value="1" name="attr_evasion_base" readonly/>
                <text>+</text>
                <input type="number" name="attr_evasion_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-stats-Row-Speed stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Speed: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" value="20" name="attr_speed_base" readonly/>
                <text>+</text>
                <input type="number" name="attr_speed_bonus" value="0"/>
            </div>
        </div>
        <div class="stats-stats-Row-EquipLoad stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Equip Load: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" value="1" name="attr_equip_load_base" readonly/>
                <text>+</text>
                <input type="number" name="attr_equip_load_bonus" value="0"/>
            </div>
        </div> 
    </div>
    <div class="sheet-stats-Armour sheet-block">
        <div class="stats-armour-Row-Title">
            <h2> Resistance </h2>
        </div>
        <div class="stats-armour-Row-Physical stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Physical: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" name="attr_phys_resist" value="0"/>
                <text>+</text>
                <input type="number" name="attr_phys_resist_bonus" value="0"/>
            </div>
        </div> 
        <div class="stats-armour-Row-Magical stats-stats-Row">
            <div class="stats-stats-Row-Name">
                <p> Magical: </p>
            </div>
            <div class="stats-stats-Row-Value">
                <input type="number" name="attr_mag_resist" value="0"/>
                <text>+</text>
                <input type="number" name="attr_mag_resist_bonus" value="0"/>
            </div>
        </div>

        <div class="stats-armour-Row-Resistant">
            <p> Add resistance: </p>
            <fieldset class="repeating_resistance">
                <select name="attr_resistance">
                    <option selected>-</option>
                    <option value="Slashing">Slashing</option>
                    <option value="Piercing">Piercing</option>
                    <option value="Bludgeoning">Bludgeoning</option>
                    <option value="Fire">Fire</option>
                    <option value="Frost">Frost</option>
                    <option value="Lightning">Lightning</option>
                    <option value="Shadow">Shadow</option>
                    <option value="Water">Water</option>
                    <option value="Poison">Poison</option>
                </select>
            </fieldset>
        </div>
    </div>
</div>

<div class="sheet-perks">
    <div class="perks-Title sheet-block">
        <h2>Perks</h2>
    </div>
    <div class="perks-Perks">
        <fieldset class="repeating_perks">
            <div class="perks-Row sheet-block">
                <div class="perks-NameL">
                    <p>Name:</p>
                </div>
                <div class="perks-Name">
                    <input type="text" name="attr_perk_name"/>
                </div>
                <div class="perks-RequirementsL">
                    <p>Requirements:</p>
                </div>
                <div class="perks-Requirements">
                    <input type="text" name="attr_perk_requirements"/>
                </div>
                <div class="perks-SourceL">
                    <p>Source:</p>
                </div>
                <div class="perks-Source">
                    <input type="text" name="attr_perk_source"/>
                </div>
                <div class="perks-Fold">
                    <button type="action" name="act_fold">&#x1F6C8;</button>
                </div>
                <input type="hidden" class="perks-Toggle" name="attr_row_toggle" value="open" /> 
                <div class="perks-DescriptionL">
                    <p>Description:</p>
                </div>
                <div class="perks-Description">
                    <textarea name="attr_perk_note" cols="20" rows="2"></textarea>
                </div>
            </div>
        </fieldset>
    </div>
</div>

<div class="sheet-weapons">
    <div class="weapons-Title sheet-block">
        <h2>Weapons</h2>
    </div>
    <div class="weapons-Attacks">
        <fieldset class="repeating_weapons">
            <div class="weapons-Row">
                <div class="weapons-Row-Title">
                    <span class="repeating-Title" name="attr_weapon_name"></span>
                </div>
                <div class="weapons-Row-Fold">
                    <button type="action" name="act_fold">&#x1F6E0;</button>
                </div>
                <input type="hidden" class="weapons-Row-Toggle" name="attr_row_toggle" value="open" /> 
                <div class="weapons-Row-Form">
                    <div class="weapons-Row-Left">
                        <div class="weapons-Row-Name weapons-FieldT">
                            <div class="weapons-Field-Name">
                                <p> Name: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <input type="text" name="attr_weapon_name" />
                            </div>
                        </div>
                        <div class="weapons-Row-Scaling weapons-FieldT">
                            <div class="weapons-Field-Name">
                                <p> Scaling: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <select name="attr_weapon_scaling">
                                    <option selected>-</option>
                                    <option value="Vigour">Vigour</option>
                                    <option value="Endurance">Endurance</option>
                                    <option value="Intelligence">Intelligence</option>
                                    <option value="Strength">Strength</option>
                                    <option value="Dexterity">Dexterity</option>
                                    <option value="Perception">Perception</option>
                                    <option value="Arcana">Arcana</option>
                                    <option value="Faith">Faith</option>
                                    <option value="Nature">Nature</option>
                                    <option value="Charisma">Charisma</option>
                                </select>
                            </div>
                        </div>
                        <div class="weapons-Row-Acc weapons-FieldN">
                            <div class="weapons-Field-Name">
                                <p> Acc Bonus: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <input type="number" name="attr_weapon_acc_bonus" value="0"/>
                            </div>
                        </div>
                        <div class="weapons-Row-Dmg  weapons-FieldN">
                            <div class="weapons-Field-Name">
                                <p> Dmg Bonus: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <input type="number" name="attr_weapon_dmg_bonus" value="0"/>
                            </div>
                        </div>
                        <div class="weapons-Row-Crit weapons-FieldN">
                            <div class="weapons-Field-Name">
                                <p> Crit Chance %: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <input type="number" name="attr_weapon_crit_chance" value="5" min="5" step="5" />
                            </div>
                        </div>
                        <div class="weapons-Row-Ranged weapons-FieldN">
                            <div class="weapons-Field-Name">
                                <p> Ranged: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <input type="checkbox" name="attr_weapon_ranged"/>
                            </div>
                        </div>
                    </div>
                    <div class="weapons-Row-Right">
                        <div class="weapons-Row-OneHanded weapons-Field">
                            <p> One Handed
                        </div>
                        <div class="weapons-Row-DiceOne weapons-FieldT">
                            <div class="weapons-Field-Name">
                                <p> Dice: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <input type="text" name="attr_weapon_dice_one"/>
                            </div>
                        </div>
                        <div class="weapons-Row-TypeOne weapons-FieldT">
                            <div class="weapons-Field-Name">
                                <p> Type: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <select name="attr_weapon_type_one">
                                    <option selected>-</option>
                                    <option value="Slashing">Slashing</option>
                                    <option value="Piercing">Piercing</option>
                                    <option value="Bludgeoning">Bludgeoning</option>
                                    <option value="Fire">Fire</option>
                                    <option value="Frost">Frost</option>
                                    <option value="Lightning">Lightning</option>
                                    <option value="Shadow">Shadow</option>
                                    <option value="Water">Water</option>
                                    <option value="Poison">Poison</option>
                                </select>
                            </div>
                        </div>
                        <div class="weapons-Row-RangeOne weapons-FieldT">
                            <div class="weapons-Field-Name">
                            <p> Range: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <input type="text" name="attr_weapon_range_one"/>
                            </div>
                        </div>
                        <div class="weapons-Row-TwoHanded weapons-Field">
                            <p> Two Handed </p>
                        </div>
                        <div class="weapons-Row-DiceTwo weapons-FieldT">
                            <div class="weapons-Field-Name">
                            <p> Dice: </p>
                        </div>
                            <div class="weapons-Field-Value">
                                <input type="text" name="attr_weapon_dice_two"/>
                            </div>
                        </div>
                        <div class="weapons-Row-TypeTwo weapons-FieldT">
                            <div class="weapons-Field-Name">
                                <p> Type: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <select name="attr_weapon_type_two">
                                    <option selected>-</option>
                                    <option value="Slashing">Slashing</option>
                                    <option value="Piercing">Piercing</option>
                                    <option value="Bludgeoning">Bludgeoning</option>
                                    <option value="Fire">Fire</option>
                                    <option value="Frost">Frost</option>
                                    <option value="Lightning">Lightning</option>
                                    <option value="Shadow">Shadow</option>
                                    <option value="Water">Water</option>
                                    <option value="Poison">Poison</option>
                                </select>
                            </div>
                        </div>
                        <div class="weapons-Row-RangeTwo weapons-FieldT">
                            <div class="weapons-Field-Name">
                            <p> Range: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <input type="text" name="attr_weapon_range_two"/>
                            </div>
                        </div>
                        <div class="weapons-Row-Secondary weapons-Field">
                            <p> Secondary: </p>
                        </div>
                        <div class="weapons-Row-DiceSecondary weapons-FieldT">
                            <div class="weapons-Field-Name">
                                <p> Dice: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <input type="text" name="attr_weapon_dice_secondary"/>
                            </div>
                        </div>
                        <div class="weapons-Row-TypeSecondary weapons-FieldT">
                            <div class="weapons-Field-Name">
                                <p> Type: </p>
                            </div>
                            <div class="weapons-Field-Value">
                                <select name="attr_weapon_type_secondary">
                                    <option selected>-</option>
                                    <option value="Slashing">Slashing</option>
                                    <option value="Piercing">Piercing</option>
                                    <option value="Bludgeoning">Bludgeoning</option>
                                    <option value="Fire">Fire</option>
                                    <option value="Frost">Frost</option>
                                    <option value="Lightning">Lightning</option>
                                    <option value="Shadow">Shadow</option>
                                    <option value="Water">Water</option>
                                    <option value="Poison">Poison</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="weapons-Row-Description weapons-FieldV">
                        <div class="weapons-Field-Name">
                            <p> Description: </p>
                        </div>
                        <div class="weapons-Field-Value">
                            <textarea name="attr_weapon_desc" cols="20" rows="2"/>
                        </div>
                    </div>
                </div>
            </div>
        </fieldset>
    </div>
</div>

<div class="sheet-rune-spells">
    <div class="rune-spells-Row-Title sheet-block">
        <h2>Rune Spells</h2>
    </div>
    <div class="rune-spells-Row-Spells">
        <fieldset class="repeating_rune-spells">
            <div class="rune-spells-Row sheet-block">
                <div class="rune-spells-Row-Title">
                    <span class="repeating-Title" name="attr_rs_name"></span>
                </div>
                <div class="rune-spells-Fold">
                    <button type="action" name="act_fold">&#x1F6E0;</button>
                </div>
                <input type="hidden" class="rune-spells-Row-Toggle" name="attr_row_toggle" value="open" /> 
                <div class="rune-spells-Form">
                    <div class="rune-spells-NameL">
                        <p>Name:</p>
                    </div>
                    <div class="rune-spells-Name">
                        <input type="text" name="attr_rs_name"/>
                    </div>
                    <div class="rune-spells-CastL">
                        <p>Cast:</p>
                    </div>
                    <div class="rune-spells-Cast">
                        <select name="attr_rs_scaling">
                            <option value="Arcana" selected>Arcana</option>
                            <option value="Faith">Faith</option>
                            <option value="Nature">Nature</option>
                        </select>
                    </div>
                    <div class="rune-spells-RangeL">
                        <p>Range:</p>
                    </div>
                    <div class="rune-spells-Range">
                        <input type="text" name="attr_rs_range"/>
                    </div>
                    <div class="rune-spells-DiceL">
                        <p>Damage:</p>
                    </div>
                    <div class="rune-spells-Dice">
                        <input type="text" name="attr_rs_dice"/>
                    </div>
                    <div class="rune-spells-APL">
                        <p>AP Cost:</p>
                    </div>
                    <div class="rune-spells-AP">
                        <input type="number" name="attr_rs_ap" value="2"/>
                    </div>
                    <div class="rune-spells-FPL">
                        <p>FP Cost:</p>
                    </div>
                    <div class="rune-spells-FP">
                        <input type="number" name="attr_rs_fp" value="0"/>
                    </div>
                    <div class="rune-spells-ConcentrationL">
                        <p>Concentration:</p>
                    </div>
                    <div class="rune-spells-Concentration">
                        <input type="checkbox" name="attr_rs_conc"/>
                    </div>
                    <div class="rune-spells-ReadyL">
                        <p>Ready:</p>
                    </div>
                    <div class="rune-spells-Ready">
                        <input type="checkbox" name="attr_rs_ready"/>
                    </div>
                    <div class="rune-spells-DescriptionL">
                        <p>Description:</p>
                    </div>
                    <div class="rune-spells-Description">
                        <textarea name="attr_rs_note" cols="20" rows="2"></textarea>
                    </div>
                </div>
            </div>
        </fieldset>
    </div>
</div>

<div class="sheet-invocation">
    <input type="hidden" class="sheet-tabstoggle" name="attr_sheetInvocation"/>
    <div class="invocation-Menu sheet-block">
        <button type="action" name="act_invocation-Memory">Memory</button>
        <button type="action" name="act_invocation-Caster">Caster</button>
        <button type="action" name="act_invocation-Saved">Saved</button>
    </div>
    <div class="invocation-Tab sheet-invocation-Memory sheet-block">
        <div class="invocation-Memory-Title">
            <h2>Invocation Memory</h2>
        </div>
        <div class="invocation-Memory-Templates invocation-Memory-Block">
            <div class="invocation-Memory-CounterL">
                <p>Templates known:</p>
            </div>
            <div class="invocation-Memory-Counter">
                <input type="number" value="0" name="attr_ic_templates_memory_used" readonly/>
                <text> /</text>
                <input type="number" value="3" name="attr_ic_spell_memory" readonly/>
            </div>
            <div class="invocation-Memory-List">
                <fieldset class="repeating_ic-templates">
                    <div class="invocation-Memory-List-Item">
                        <select name="attr_ic_template_memory">
                            <option selected>-</option>
                            <option value="touch">Touch</option>
                            <option value="bolt">Bolt</option>
                            <option value="orb">Orb</option>
                            <option value="cone">Cone</option>
                            <option value="rebuttal">Rebuttal</option>
                            <option value="cloud">Cloud</option>
                            <option value="buff">Buff</option>
                            <option value="enchantment">Enchantment</option>
                            <option value="cloak">Cloak</option>
                            <option value="aura">Aura</option>
                            <option value="beam">Beam</option>
                            <option value="wall">Wall</option>
                            <option value="wave">Wave</option>
                            <option value="explosion">Explosion</option>
                            <option value="glyph">Glyph</option>
                        </select>
                    </div>
                </fieldset>
            </div>
        </div>

        <div class="invocation-Memory-Effects invocation-Memory-Block">
            <div class="invocation-Memory-CounterL">
                <p>Effects known:</p>
            </div>
            <div class="invocation-Memory-Counter">
                <input type="number" value="0" name="attr_ic_effects_memory_used" readonly/>
                <text> /</text>
                <input type="number" value="3" name="attr_ic_spell_memory" readonly/>
            </div>
            <div class="invocation-Memory-List">
                <fieldset class="repeating_ic-effects">
                    <select name="attr_ic_effect_memory">
                        <option selected>-</option>
                        <option value="fire_damage">Fire Damage</option>
                        <option value="ice_damage">Ice Damage</option>
                        <option value="lightning_damage">Lightning Damage</option>
                        <option value="shadow_damage">Shadow Damage</option>
                        <option value="water_damage">Water Damage</option>
                        <option value="poison_damage">Poison Damage</option>
                        <option value="force_damage">Force Damage</option>
                        <option value="dispel">Dispel</option>
                        <option value="slow">Slow</option>
                        <option value="haste">Haste</option>
                        <option value="freeze">Freeze</option>
                        <option value="resist_fire">Resist Fire</option>
                        <option value="resist_frost">Resist Frost</option>
                        <option value="alarm">Alarm</option>
                        <option value="levitation">Levitation</option>
                        <option value="arcane_flight">Arcane Flight</option>
                        <option value="charm">Charm</option>
                        <option value="reveal">Reveal</option>
                        <option value="arcane_eye">Arcane Eye</option>
                        <option value="telekinesis">Telekinesis</option>
                        <option value="healing_light">Healing Light</option>
                        <option value="terrify">Terrify</option>
                        <option value="truth">Truth</option>
                        <option value="light">Light</option>
                        <option value="darkness">Darkness</option>
                        <option value="resist_lightning">Resist Lightning</option>
                        <option value="destroy_undead">Destroy Undead</option>
                        <option value="silence">Silence</option>
                        <option value="celestial_flight">Celestial Flight</option>
                        <option value="become_incorporeal">Become Incorporeal</option>
                        <option value="invisibility">Invisibility</option>
                        <option value="ward">Ward</option>
                        <option value="divine_sense">Divine Sense</option>
                        <option value="balm_of_nature">Balm of Nature</option>
                        <option value="pull">Pull</option>
                        <option value="resist_poison">Resist Poison</option>
                        <option value="feather_fall">Feather Fall</option>
                        <option value="entangle">Entangle</option>
                        <option value="water_breathing">Water Breathing</option>
                        <option value="bark_skin">Bark Skin</option>
                        <option value="reinforce_object">Reinforce Object</option>
                        <option value="mending">Mending</option>
                        <option value="eagle's_wings">Eagle's Wings</option>
                        <option value="petrify">Petrify</option>
                        <option value="cleanse">Cleanse</option>
                    </select>
                </fieldset>
            </div>
        </div>
    </div>
    <div class="invocation-Tab sheet-invocation-Caster sheet-block">
        <div class="invocation-Caster-Title">
            <h2>Invocation Caster</h2>
        </div>
        <div class="invocation-Caster-TemplateL">
            <p>Template:</p>
        </div>
        <div class="invocation-Caster-Template">
            <select name="attr_ic_template">
                <option value="touch" selected>Touch</option>
                <option value="bolt">Bolt</option>
                <option value="orb">Orb</option>
                <option value="cone">Cone</option>
                <option value="rebuttal">Rebuttal</option>
                <option value="cloud">Cloud</option>
                <option value="buff">Buff</option>
                <option value="enchantment">Enchantment</option>
                <option value="cloak">Cloak</option>
                <option value="aura">Aura</option>
                <option value="beam">Beam</option>
                <option value="wall">Wall</option>
                <option value="wave">Wave</option>
                <option value="explosion">Explosion</option>
                <option value="glyph">Glyph</option>
            </select>
        </div>
        <div class="invocation-Caster-TierL">
            <p>Tier:</p>
        </div>
        <div class="invocation-Caster-Tier">
            <select name="attr_ic_tier">
                <option selected>-</option>
                <option value="1">I</option>
                <option value="2">II</option>
                <option value="3">III</option>
                <option value="4">IV</option>
                <option value="5">V</option>
            </select>
        </div>
        <div class="invocation-Caster-CastL">
            <p>Cast:</p>
        </div>
        <div class="invocation-Caster-Cast">
            <select name="attr_ic_scaling">
                <option value="Arcana" selected>Arcana</option>
                <option value="Faith">Faith</option>
                <option value="Nature">Nature</option>
            </select>
        </div>
        <div class="invocation-Caster-EffectL">
            <p>Effect:</p>
        </div>
            <div class="invocation-Caster-Effect">
                <input type="hidden" class="sheet-ic_scaling_toggle" name="attr_ic_scaling"  value="Arcana"/> 
                <div class="sheet-arcane">
                <select name="attr_ic_effect">
                    <option selected>-</option>
                    <option value="fire_damage">Fire Damage</option>
                    <option value="ice_damage">Ice Damage</option>
                    <option value="shadow_damage">Shadow Damage</option>
                    <option value="force_damage">Force Damage</option>
                    <option value="dispel">Dispel</option>
                    <option value="slow">Slow</option>
                    <option value="haste">Haste</option>
                    <option value="freeze">Freeze</option>
                    <option value="resist_fire">Resist Fire</option>
                    <option value="resist_frost">Resist Frost</option>
                    <option value="alarm">Alarm</option>
                    <option value="levitation">Levitation</option>
                    <option value="arcane_flight">Arcane Flight</option>
                    <option value="charm">Charm</option>
                    <option value="reveal">Reveal</option>
                    <option value="arcane_eye">Arcane Eye</option>
                    <option value="telekinesis">Telekinesis</option>
                </select>
                </div>
                <div class="sheet-faith">
                <select name="attr_ic_effect">
                    <option selected>-</option>
                    <option value="fire_damage">Fire Damage</option>
                    <option value="lightning_damage">Lightning Damage</option>
                    <option value="shadow_damage">Shadow Damage</option>
                    <option value="poison_damage">Poison Damage</option>
                    <option value="water_damage">Water Damage</option>
                    <option value="healing_light">Healing Light</option>
                    <option value="terrify">Terrify</option>
                    <option value="truth">Truth</option>
                    <option value="light">Light</option>
                    <option value="darkness">Darkness</option>
                    <option value="resist_lightning">Resist Lightning</option>
                    <option value="destroy_undead">Destroy Undead</option>
                    <option value="silence">Silence</option>
                    <option value="celestial_flight">Celestial Flight</option>
                    <option value="become_incorporeal">Become Incorporeal</option>
                    <option value="invisibility">Invisibility</option>
                    <option value="ward">Ward</option>
                    <option value="divine_sense">Divine Sense</option>
                    <option value="cleanse">Cleanse</option>
                </select>
                </div>
                <div class="sheet-nature">
                <select name="attr_ic_effect">
                    <option selected>-</option>
                    <option value="lightning_damage">Lightning Damage</option>
                    <option value="ice_damage">Ice Damage</option>
                    <option value="poison_damage">Poison Damage</option>
                    <option value="force_damage">Force Damage</option>
                    <option value="water_damage">Water Damage</option>
                    <option value="balm_of_nature">Balm of Nature</option>
                    <option value="pull">Pull</option>
                    <option value="resist_poison">Resist Poison</option>
                    <option value="feather_fall">Feather Fall</option>
                    <option value="entangle">Entangle</option>
                    <option value="water_breathing">Water Breathing</option>
                    <option value="bark_skin">Bark Skin</option>
                    <option value="reinforce_object">Reinforce Object</option>
                    <option value="mending">Mending</option>
                    <option value="eagle's_wings">Eagle's Wings</option>
                    <option value="petrify">Petrify</option>
                </select>
            </div>
        </div>
        <div class="invocation-Caster-NameL">
            <hr>
            <p>Name</p>
        </div>
        <div class="invocation-Caster-Name">
            <hr>
            <input type="text" name="attr_ic_name" value="" readonly />
        </div>
        <div class="invocation-Caster-DiceL">
            <hr>
            <p>Dice</p>
        </div>
        <div class="invocation-Caster-Dice">
            <hr>
            <input type="text" value="" name="attr_ic_dice" readonly />
        </div>
        <div class="invocation-Caster-IntL">
            <p>Intelligence Required</p>
        </div>
        <div class="invocation-Caster-Int">
            <input type="number" value="0" name="attr_ic_int_req" readonly />
        </div>
        <div class="invocation-Caster-APL">
            <p>AP Cost</p>
        </div>
        <div class="invocation-Caster-AP">
            <input type="number" value="0" name="attr_ic_ap" readonly />
        </div>
        <div class="invocation-Caster-AttrL">        
            <p>Attribute Required</p>
        </div>
        <div class="invocation-Caster-Attr">
            <input type="number" value="0" name="attr_ic_attr_req" readonly />
        </div>
        <div class="invocation-Caster-FPL">
            <p>FP Cost</p>
        </div>
        <div class="invocation-Caster-FP">
            <input type="number" value="0" name="attr_ic_fp" readonly />
        </div>
        <div class="invocation-Caster-Warning">
            <input class="ic_warning" type="hidden" name="attr_ic_warning" value="" readonly/>
            <div class="ic_warning_template"><input type="text" name="attr_ic_warning_template" value="" readonly><br></div>
            <div class="ic_warning_effect"><input type="text" name="attr_ic_warning_effect" value="" readonly><br></div>
            <div class="ic_warning_int"><input type="text" name="attr_ic_warning_int" value="" readonly><br></div>
            <div class="ic_warning_attr"><input type="text" name="attr_ic_warning_attr" value="" readonly><br></div>
        </div>
        <div class="invocation-Caster-Description">
            <p>Description</p>
            <textarea name="attr_ic_desc_full" cols="20" rows="2" readonly></textarea>
        </div>
        <div class="invocation-Caster-Save">
            <button type="action" name="act_ic_save">Save</button>
        </div>
    </div>
    <div class="invocation-Tab sheet-invocation-Saved">
        <div class="invocation-Saved-Title sheet-block">
            <h2>Invocation Saved</h2>
        </div>
        <div class="invocation-Saved-Spells">
            <fieldset class="repeating_ic-saved">
                <div class="invocation-Saved-Row sheet-block">
                    <div class="invocation-Saved-Row-Title">
                        <span class="repeating-Title" name="attr_ic_name"></span>
                    </div>
                    <div class="invocation-Saved-Row-Fold">
                        <button type="action" name="act_fold">&#x1F6E0;</button>
                    </div>
                    <input type="hidden" class="invocation-Saved-Row-Toggle" name="attr_row_toggle" value="open" /> 
                    <div class="invocation-Saved-Block">
                        <div class="invocation-Saved-NameL">
                            <p>Name</p>
                        </div>
                        <div class="invocation-Saved-Name">
                            <input type="text" name="attr_ic_name" value="" readonly />
                        </div>
                        <div class="invocation-Saved-DiceL">
                            <p>Dice</p>
                        </div>
                        <div class="invocation-Saved-Dice">
                            <input type="text" value="" name="attr_ic_dice" readonly />
                        </div>
                        <div class="invocation-Saved-IntL">
                            <p>Intelligence Required</p>
                        </div>
                        <div class="invocation-Saved-Int">
                            <input type="number" value="0" name="attr_ic_int_req" readonly />
                        </div>
                        <div class="invocation-Saved-APL">
                            <p>AP Cost</p>
                        </div>
                        <div class="invocation-Saved-AP">
                            <input type="number" value="0" name="attr_ic_ap" readonly />
                        </div>
                        <div class="invocation-Saved-AttrL">        
                            <p>Attribute Required</p>
                        </div>
                        <div class="invocation-Saved-Attr">
                            <input type="number" value="0" name="attr_ic_attr_req" readonly />
                        </div>
                        <div class="invocation-Saved-FPL">
                            <p>FP Cost</p>
                        </div>
                        <div class="invocation-Saved-FP">
                            <input type="number" value="0" name="attr_ic_fp" readonly />
                        </div>
                        <div class="invocation-Saved-Description">
                            <p>Description</p>
                            <textarea name="attr_ic_desc_full" cols="20" rows="2" readonly></textarea>
                        </div>
                        <!--hidden fields-->
                        <input type="text" value="" name="attr_ic_scaling" readonly hidden/>
                        <input type="text" value="" name="attr_ic_range" readonly hidden/>
                        <input type="text" value="" name="attr_ic_duration" readonly hidden/>
                        <input type="text" value="" name="attr_ic_contested" readonly hidden/>
                        <input type="text" value="" name="attr_ic_desc" readonly hidden/><!--roll display description-->
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
</div>

<div class="sheet-inventory">
    <div class="inventory-Title sheet-block">
        <h2>Inventory</h2>
    </div>
    <div class="inventory-Inventory">
        <fieldset class="repeating_inventory">
            <div class="inventory-Row sheet-block">
                <div class="inventory-NameL">
                    <p>Name:</p>
                </div>
                <div class="inventory-Name">
                    <input type="text" name="attr_item_name"/>
                </div>
                <div class="inventory-RequirementsL">
                    <p>Amount:</p>
                </div>
                <div class="inventory-Requirements">
                    <input type="text" name="attr_item_amount"/>
                </div>
                <div class="inventory-SourceL">
                    <p>Type:</p>
                </div>
                <div class="inventory-Source">
                    <input type="text" name="attr_item_type"/>
                </div>
                <div class="inventory-Fold">
                    <button type="action" name="act_fold">&#x1F6C8;</button>
                </div>
                <input type="hidden" class="inventory-Toggle" name="attr_row_toggle" value="open" /> 
                <div class="inventory-DescriptionL">
                    <p>Note:</p>
                </div>
                <div class="inventory-Description">
                    <textarea name="attr_item_note" cols="20" rows="2"></textarea>
                </div>
            </div>
        </fieldset>
    </div>
</div>

<div class="sheet-character">
    <input type="hidden" class="sheet-tabstoggle" name="attr_sheetEquipment"/>
    <div class="character-Menu sheet-block">
        <button type="action" name="act_equipment-Armour">Armour</button>
        <button type="action" name="act_equipment-Equipment">Equipment</button>
        <button type="action" name="act_equipment-Info">Info</button>
    </div>
    <div class="character-Armour sheet-block">
        <div class="character-Armour-Title">
            <h2>Armour</h2></div>
        <div class="character-Armour-NameL">
            <p>Name:</p>
        </div>
        <div class="character-Armour-Name">
            <input type="text" name="attr_armour_name"/>
        </div>
        <div class="character-Armour-PhysL">
            <p>Physical Resist:</p>
        </div>
        <div class="character-Armour-Phys">
            <input type="number" name="attr_armour_phys" value="0"/>
        </div>
        <div class="character-Armour-MagL">
            <p>Magical Resist:</p>
        </div>
        <div class="character-Armour-Mag">
            <input type="number" name="attr_armour_mag" value="0"/>
        </div>
        <div class="character-Armour-SpeedL">
            <p>Speed Penalty:</p>
        </div>
        <div class="character-Armour-Speed">
            <input type="number" name="attr_armour_speed" value="0"/>
        </div>
        <div class="character-Armour-WeightL">
            <p>Weight:</p>
        </div>
        <div class="character-Armour-Weight">
            <input type="number" name="attr_armour_weight" value="0"/>
        </div>
        <div class="character-Armour-EvasionL">
            <p>Evasion Penalty:</p>
        </div>
        <div class="character-Armour-Evasion">
            <select name="attr_armour_evasion">
                <option selected value="1">None</option>
                <option value="0.5">Halved</option>
                <option value="0">Full</option>
            </select>
        </div>
        <div class="character-Armour-EvasionMod">
            <input type="number" name="attr_armour_evasion_mod" value="0"/>
        </div>
        <div class="character-Armour-NoteL">
            <p>Note:</p>
        </div>
        <div class="character-Armour-Note">
            <textarea name="attr_armour_note" cols="20" rows="2"></textarea>
        </div>
    </div>
    <div class="character-Equipment">
        <div class="character-Equipment-Title sheet-block">
            <h2>Equipment</h2>
        </div>
        <div class="character-Equipment-Block">
            <fieldset class="repeating_equipment">
                <div class="character-Equipment-Row sheet-block">
                    <div class="character-NameL">
                        <p>Name:</p>
                    </div>
                    <div class="character-Name">
                        <input type="text" name="attr_eq_name"/>
                    </div>
                    <div class="character-TypeL">
                        <p>Type:</p>
                    </div>
                    <div class="character-Type">
                        <select name="attr_eq_type">
                            <option selected>-</option>
                            <option value="weapon">Weapon</option>
                            <option value="armour">Armour</option>
                            <option value="helmet">Helmet</option>
                            <option value="gloves">Gloves</option>
                            <option value="boots">Boots</option>
                            <option value="mask">Mask</option>
                            <option value="ring">Ring</option>
                            <option value="necklace">Necklace</option>
                            <option value="bracelet">Bracelet</option>
                        </select>
                    </div>
                    <div class="character-WeightL">
                        <p>Weight:</p>
                    </div>
                    <div class="character-Weight">
                        <input type="number" name="attr_eq_weight" value="0"/>
                    </div>
                    <div class="character-Fold">
                        <button type="action" name="act_fold">&#x1F6C8;</button>
                    </div>
                    <input type="hidden" class="character-Toggle" name="attr_row_toggle" value="open" /> 
                    <div class="character-NoteL">
                        <p>Note:</p>
                    </div>
                    <div class="character-Note">
                        <textarea name="attr_eq_note" cols="20" rows="2"></textarea>
                    </div>
                </div>
            </fieldset>
        </div>
    </div>
    <div class="character-Info sheet-block">
        <div class="info-Appearance">
            <div class="info-Appearance-Title">
                Appearance, Vision, Languages, Alignment
            </div>
            <div class="info-Gender info-field">
                <input type="text" name="attr_info_gender"/><br>Gender
            </div>
            <div class="info-Age info-field">
                <input type="text" name="attr_info_age"/><br>Age
            </div>
            <div class="info-Height info-field">
                <input type="text" name="attr_info_height"/><br>Height
            </div>
            <div class="info-Weight info-field">
                <input type="text" name="attr_info_weight"/><br>Weight
            </div>
            <div class="info-Eyes info-field">
                <input type="text" name="attr_info_eyes"/><br>Eyes
            </div>
            <div class="info-Hair info-field">
                <input type="text" name="attr_info_hair"/><br>Hair
            </div>
            <div class="info-Size info-field">
                <input type="text" name="attr_info_size"/><br>Size
            </div>
            <div class="info-Vision info-field">
                <input type="text" name="attr_info_vision"/><br>Vision
            </div>
            <div class="info-Languages info-field">
                <input type="text" name="attr_info_languages"/><br>Languages
            </div>
            <div class="info-Alignment info-field">
                <input type="text" name="attr_info_alignment"/><br>Alignment
            </div>
        </div>
        <div class="info-Traits">
            <div class="info-Traits-Banner">
                Traits and background
            </div>
            <div class="info-Racial info-field">
                <textarea type="text" name="attr_info_racial"/></textarea>Racial
            </div>
            <div class="info-Personality info-field">
                <textarea type="text" name="attr_info_personality"/></textarea>Personality
            </div>
            <div class="info-Background info-field">
                <textarea type="text" name="attr_info_background"/></textarea>Background
            </div>
        </div>
        <div class="info-Proficiencies">
            <div class="info-Proficiencies-Banner">
                Proficiencies
            </div>
            <div class="info-Armour info-field">
                <textarea type="text" name="attr_info_armour"/></textarea>Armour
            </div>
            <div class="info-Weapon info-field">
                <textarea type="text" name="attr_info_weapon"/></textarea>Weapons
            </div>
            <div class="info-Tool info-field">
                <textarea type="text" name="attr_info_tool"/></textarea>Tools
            </div>
        </div>
        <div class="info-Backstory info-field">
            Bio
            <textarea name="attr_info_backstory" cols="20" rows="2"></textarea>
            <span class="hint">Aethes sheet version 1.2</span>
        </div>
    </div>
</div>

</div><!--end tag for master-->

<script type="text/worker">
    // attributes lists
    const baseAttributes = ["Vigour","Endurance","Intelligence","Strength","Dexterity","Perception","Arcana","Faith","Nature","Charisma"];
    const armourAttributes = ["phys_resist","mag_resist"];
    const bonusAttributes = [...baseAttributes, ...armourAttributes].map(attr => attr + "_bonus");
    const armourValues = ["armour_name","armour_phys", "armour_mag", "armour_evasion", "armour_evasion_mod", "armour_speed", "armour_weight"]
    const allAttributes = [...baseAttributes, ...armourAttributes, ...bonusAttributes, ...armourValues];
    const baseEvents = allAttributes.map(attr => "change:" + attr).join(" ")
    const damageTypes = ["slashing","piercing","bludgeoning","fire","frost","shadow","water","poison"]

    
    const bubbleFieldList = ["hp", "barrier", "barrier_max", "vitality", "fp", "sp", "equip_load"]
    const bubbleFieldEvents = bubbleFieldList.map(attr => "change:" + attr).join(" ")+" "+baseEvents
    on("", function(obj, prev) {
        let result = {};
        result[obj.sourceAttribute] = obj.newValue;
        if (/^[+\-*/%]\d+/.test(obj.newValue)) {
            result[obj.sourceAttribute] = jsSum(eval(obj.newValue), obj.previousValue);
        }
        setAttrs(result);
    });


    // prompt
    const promptTakeDamage = ["promptTakeDamage","promptClose","promptTake"];
    promptTakeDamage.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                promptTakeDamage: button
            });
        });
        on(`sheet:opened`, function() {
            setAttrs({
                promptTakeDamage: "promptClose"
            });
        });
    });

    // sheet tabs
    const buttonlist = ["overview","stats","perks","weapons","rune-spells","invocation","inventory","equipment"];
    buttonlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetTab: button
            });
        });
    });

    // invocation tabs
    const invocationslist = ["invocation-Memory","invocation-Caster","invocation-Saved"];
    invocationslist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetInvocation: button
            });
        });
    });

    // equipment tabs
    const equipmentlist = ["equipment-Armour","equipment-Equipment","equipment-Info"];
    equipmentlist.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                sheetEquipment: button
            });
        });
    });
    
    // attack mode button
    const attackmode = ["attacknormal","attackadvantage","attackdisadvantage"];
    attackmode.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                attackMode: button.replace("attack", "")
            });
        });
        on(`sheet:opened`, function() {
            setAttrs({
                attackMode: "normal"
            });
        });
    });

    // attack mode button
    const attributemode = ["attributenormal","attributeadvantage","attributedisadvantage"];
    attributemode.forEach(button => {
        on(`clicked:${button}`, function() {
            setAttrs({
                attributeMode: button.replace("attribute", "")
            });
        });
        on(`sheet:opened`, function() {
            setAttrs({
                attributeMode: "normal"
            });
        });
    });

    function jsSum(...args) {
        let total = 0;
        for (let i = 0; i < args.length; i++) {
            total += parseInt(args[i]) || 0;
        }
        return total;
    }
    function minusToZero(a, b) {
        const out = parseInt(a) - parseInt(b);
        return (out < 0) ? 0 : out;
    }

    // Don't ask me, not my function -> https://wiki.roll20.net/RepeatingSum
    /* ===== PARAMETERS ==========
    destinations = the name of the attribute that stores the total quantity
            can be a single attribute, or an array: ['total_cost', 'total_weight']
            If more than one, the matching fields must be in the same order. 
        section = name of repeating fieldset, without the repeating_
        fields = the name of the attribute field to be summed
              destination and fields both can be a single attribute: 'weight'
              or an array of attributes: ['weight','number','equipped']
    */
    const repeatingSum = (destinations, section, fields) => {
        if (!Array.isArray(destinations)) destinations = [destinations.replace(/\s/g, '').split(',')];
        if (!Array.isArray(fields)) fields = [fields.replace(/\s/g, '').split(',')];
        getSectionIDs(`repeating_${section}`, idArray => {
            const attrArray = idArray.reduce((m, id) => [...m, ...(fields.map(field => `repeating_${section}_${id}_${field}`))], []);
            getAttrs([...attrArray], v => {
                const getValue = (section, id, field) => v[`repeating_${section}_${id}_${field}`] === 'on' ? 1 : parseFloat(v[`repeating_${section}_${id}_${field}`]) || 0;
                const commonMultipliers = (fields.length <= destinations.length) ? [] : fields.splice(destinations.length, fields.length - destinations.length);
                const output = {};
                destinations.forEach((destination, index) => {
                    output[destination] = idArray.reduce((total, id) => total + getValue(section, id, fields[index]) * commonMultipliers.reduce((subtotal, mult) => subtotal * getValue(section, id, mult), 1), 0);
                });
                setAttrs(output);
            }); 
        }); 
    };

    function snakeToTitleCase(str) {return str.split('_').map(word => word.charAt(0).toUpperCase() + word.slice(1)).join(' ');}

    // calculate used rune spell memory
    on('sheet:opened change:repeating_rune-spells remove:repeating_rune-spells', function() {
        repeatingSum("rs_memory_used", "rune-spells", "rs_ready");
    });

    // calculate used invocation effects memory
    on('sheet:opened change:repeating_ic-effects remove:repeating_ic-effects', function() {
        getSectionIDs('repeating_ic-effects', idArray => {
            getAttrs(idArray.map((id) => `repeating_ic-effects_${id}_ic_effect_memory`), function(values) {
                setAttrs({
                    ic_effects_memory_used: idArray.filter(id => !values[`repeating_ic-effects_${id}_ic_effect_memory`].includes("damage")).length,
                });
            });
        });
    });

    // calculate used invocation template memory
    on('sheet:opened change:repeating_ic-templates remove:repeating_ic-templates', function() {
        getSectionIDs('repeating_ic-templates', idArray => {
            setAttrs({
                ic_templates_memory_used: idArray.length,
            });
        });
    });

    // list resistances
    on('sheet:opened change:repeating_resistance remove:repeating_resistance', function() {
        getSectionIDs('repeating_resistance', idArray => {
            getAttrs(idArray.map((id) => `repeating_resistance_${id}_resistance`), function(values) {
                setAttrs({
                    resistances_list: idArray.map((id) => values[`repeating_resistance_${id}_resistance`].toLowerCase()),
                });
            });
        });
    });

    // Parses out the section name, row id, and attribute/button name
    const parseTriggerName = function(string){
        let match = string.replace(/^clicked:/,'').match(/(?:(repeating_[^_]+)_([^_]+)_)?(.+)/);
        match.shift();
        return match;
    };

    // weapons fold
    on("clicked:repeating_weapons:fold clicked:repeating_rune-spells:fold clicked:repeating_ic-saved:fold clicked:repeating_perks:fold clicked:repeating_inventory:fold clicked:repeating_equipment:fold",(event) => {
        const [section,rowID] = parseTriggerName(event.triggerName);
        const row = `${section}_${rowID}`;
        getAttrs([`${row}_row_toggle`], (values) => {
            let toggle = {}
            toggle[`${row}_row_toggle`] = (values[`${row}_row_toggle`] == "open") ? "close" : "open";
            console.log(toggle)
            setAttrs(Object.assign(toggle));
        })
    })

    // roll attack hit
    on("clicked:repeating_attacks:attack-one clicked:repeating_attacks:attack-two",(event) => {
        const hand = event.htmlAttributes.name.replace("act_", "")
        const [section,rowID] = parseTriggerName(event.triggerName);
        // Assemble the row string so we can use it easily later
        const attack = `${section}_${rowID}_attack`;
        // Get all the attributes we need
        // Note the async tag here. This will allow us to await 
        // startroll instead of using the callback syntax.
        getAttrs(["character_name", "attackMode", `${attack}_name`,`${attack}_acc_bonus`,`${attack}_crit_chance`,`${attack}_scaling`,`${attack}_ranged`,`${attack}_range`,`${attack}_spell`,`${attack}_dmg_bonus`,`${attack}_dice_one`,`${attack}_type_one`,`${attack}_dice_two`,`${attack}_type_two`,`${attack}_dice_secondary`,`${attack}_type_secondary`,...allAttributes], async (values) => {

            const scaling = values[`${attack}_scaling`]
            const acc = jsSum(values[scaling], values[`${scaling}_bonus`], values[`${attack}_acc_bonus`])


            const type = (values[`${attack}_spell`] != 0) ? "{{spell=1}}" : "{{weapon=1}}"
            const category = (values[`${attack}_spell`] != 0) ? `{{category=${scaling}}}` : ((values[`${attack}_ranged`] != 0) ? `{{category=Ranged Attack}}` : `{{category=Melee Attack}}`)

            const critThreshold = 20 - parseInt(values[`${attack}_crit_chance`]) / 5
            const rollString = `&{template:atk} {{charname=${values.character_name}}} {{title=${values[`${attack}_name`]}}} ${type} ${category} {{r1=[[1d20cs>${critThreshold}+${acc}]]}} {{r2=[[1d20cs>${critThreshold}${(acc>0)?`+${acc}`:""}]]}} {{${values.attackMode}=1}} {{damage=${`~${values.character_name}|${attack}_dmg`}}}`

            // Send the roll to the parser
            const results = await startRoll(rollString);

            let damage = (hand == "attack-one") ? `{{dmg1flag=1}} {{dmg1=[[${values[`${attack}_dice_one`]}+${values[scaling]}${(values[`${attack}_dmg_bonus`] != "")? "+"+values[`${attack}_dmg_bonus`]:""}]]}} {{dmg1type=${values[`${attack}_type_one`]}}}` : `{{dmg1flag=1}} {{dmg1=[[${values[`${attack}_dice_two`]}+${values[scaling]}${(values[`${attack}_dmg_bonus`] != "")? "+"+values[`${attack}_dmg_bonus`]:""}]]}} {{dmg1type=${values[`${attack}_type_two`]}}}`
            damage += (values[`${attack}_dice_secondary`] != "") ? ` {{dmg2flag=1}} {{dmg2=[[${values[`${attack}_dice_secondary`]}]]}} {{dmg2type=${values[`${attack}_type_secondary`]}}}` : ""

            const r1 = results.results.r1.dice[0]
            const r2 = results.results.r2.dice[0]
            const dice = (values.attackMode == "normal") ? r1 : ((values.attackMode == "advantage") ? Math.max(r1, r2) : Math.min(r1, r2))

            let critical = (dice >= critThreshold) ? `{{crit=1}} {{crit1=[[${(hand == "attack-one") ? values[`${attack}_dice_one`] : values[`${attack}_dice_two`]}]]}}` : ""
            critical  += (values[`${attack}_dice_secondary`] != "" && dice >= critThreshold) ? ` {{crit2=[[${values[`${attack}_dice_secondary`]}]]}}` : ""

            const damageString = `&{template:dmg} {{damage=1}} {{charname=${values.character_name}}} {{title=${values[`${attack}_name`]}}} ${type} ${category} ${damage} ${critical}`

            damageRoll = {}
            damageRoll[`${attack}_roll_dmg`] = damageString

            setAttrs(Object.assign(damageRoll));

            // Tell roll20 that the roll is ready to be displayed in chat
            finishRoll(results.rollId);
        })
    })

    // roll attribute
    on("clicked:rollVigour clicked:rollEndurance clicked:rollIntelligence clicked:rollStrength clicked:rollDexterity clicked:rollPerception clicked:rollArcana clicked:rollFaith clicked:rollNature clicked:rollCharisma",(event) => {

        const rolledAttribute = event.htmlAttributes.name.replace("act_roll", "")

        getAttrs(["character_name", "attributeMode",...allAttributes], async (values) => {

            const mod = parseInt(values[rolledAttribute])+parseInt(values[`${rolledAttribute}_bonus`])
            const rollString = `&{template:simple} {{title=${rolledAttribute}}} {{attribute=1}} {{charname=${values.character_name}}} {{${values.attributeMode}=1}} {{type=Attribute Roll}} {{r1=[[1d20+${mod}]]}} ${(values.attributeMode != "normal")?`{{r2=[[1d20+${mod}]]}}`:""} `

            const results = await startRoll(rollString);

            // Tell roll20 that the roll is ready to be displayed in chat
            finishRoll(results.rollId);
        });
    });

    // roll fortune
    on("clicked:rollFortune",(event) => {
        getAttrs(["character_name", "attributeMode",...allAttributes], async (values) => {

            const rollString = `&{template:desc} {{title=Fortune}} {{spell=1}} {{charname=${values.character_name}}} {{desc=${fortunes[Math.floor(Math.random() * fortunes.length)]}}}`

            const results = await startRoll(rollString);

            // Tell roll20 that the roll is ready to be displayed in chat
            finishRoll(results.rollId);
        });
    });

    // reset values on rest
    on("clicked:rest", function() {
        getAttrs(["hp_max", "vitality_max", "fp_max", "sp_max"], function(values) {
            setAttrs({
                hp: values.hp_max,
                barrier: 0,
                vitality: values.vitality_max, // TODO check current rules for vitality reset
                fp: values.fp_max,
                sp: values.sp_max,
            });
        });
    });

    // reset values on rest
    on("clicked:barrier_reset", function() {
        getAttrs(["barrier_max"], function(values) {
            setAttrs({
                barrier: values.barrier_max
            });
        });
    });

    // calculate damage to be taken
    on(damageTypes.map((damage) => `change:take_${damage}`).join(" "), function() {
        getAttrs(["phys_resist_total", "mag_resist_total", "resistances_list", ...damageTypes.map((damage) => `take_${damage}`)], function(values) {

            const physicalDamageTypes = ["slashing","piercing","bludgeoning"]

            // for all damage types -> (DamageToTake - phys/mag resistance) / 2(if resistant)
            let calcDamage = damageTypes.reduce((sum, damage) => {
                let takeDamage = minusToZero(values[`take_${damage}`], parseInt((damage in physicalDamageTypes) ? values.phys_resist_total : values.mag_resist_total))
                takeDamage = (values.resistances_list.includes(damage)) ? Math.floor(takeDamage / 2) : takeDamage
                return sum + ((values[`take_${damage}`] > 0 & takeDamage == 0) ? 1 : takeDamage);
            }, 0);

            setAttrs({
                calc_take_damage: calcDamage,
            });
        });
    });

    // take damage
    on("clicked:promptTake", function() {
        getAttrs(["hp", "barrier", "phys_resist_total", "mag_resist_total", "calc_take_damage"], function(values) {

            const physicalDamageTypes = ["slashing","piercing","bludgeoning"]

            let calcDamage = values.calc_take_damage

            const calcBarrier = parseInt(values.barrier) - calcDamage
            calcDamage = (calcBarrier < 0) ? -calcBarrier : 0

            const takeReset = damageTypes.reduce((obj, damage) => {
              obj[`take_${damage}`] = 0;
              return obj;
            }, {});

            setAttrs(Object.assign({
                barrier: (calcBarrier < 0) ? 0 : calcBarrier,
                hp: minusToZero(values.hp, calcDamage),
            }, takeReset));
        });
    });

    // save currently remembered templates
    on('sheet:opened change:repeating_ic-templates remove:repeating_ic-templates', () => {
    getSectionIDs('repeating_ic-templates', (idarray) => {
        getAttrs(idarray.map((id) => `repeating_ic-templates_${id}_ic_template_memory`), (values) => {
            setAttrs({ic_tmemory: idarray.map((id) => values[`repeating_ic-templates_${id}_ic_template_memory`])});
            });
        });
    });

    // save currently remembered effects
    on('sheet:opened change:repeating_ic-effects remove:repeating_ic-effects', () => {
    getSectionIDs('repeating_ic-effects', (idarray) => {
        getAttrs(idarray.map((id) => `repeating_ic-effects_${id}_ic_effect_memory`), (values) => {
            setAttrs({ic_ememory: idarray.map((id) => values[`repeating_ic-effects_${id}_ic_effect_memory`])});
            });
        });
    });

    function getEffectDetails(effectName) { 
        const effectDetails = spellEffects[effectName];
        return {
            attr_required: effectDetails[0],
            ap_cost: effectDetails[1],
            fp_cost: effectDetails[2],
            concentration: effectDetails[3],
            contested: effectDetails[4],
            description: effectDetails[5]
        };
    }

    function getTemplateDetails(templateName) {
        const spellTemplate = spellTemplates[templateName];
        return {
            int_required: spellTemplate[0],
            ap_cost: spellTemplate[1],
            fp_cost: spellTemplate[2],
            concentration: spellTemplate[3],
            range: spellTemplate[4],
            duration: spellTemplate[5],
            description: spellTemplate[6]
        };
    }

    function getTieredEffect(effectName, tier) { 
        let index = (parseInt(tier) || 1) - 1;
        // I know what the function is called but I'll abuse a system I made if I want to
        const specialCases = {  
            "ward": {dice:"3d10", tier:"", fp_cost:0, ap_cost:0, req_cost:0},
            "healing_light": {dice:"1d10", tier:"", fp_cost:0, ap_cost:0, req_cost:0},
            "balm_of_nature": {dice:"1d6", tier:"", fp_cost:0, ap_cost:0, req_cost:0},
        }
        if (effectName in specialCases) {return specialCases[effectName];}

        return {
            dice: (effectName in diceMap) ? diceMap[effectName][index] : "",
            tier: (effectName in diceMap) ? tierMap[index][0] : "",
            fp_cost: (effectName in diceMap) ? tierMap[index][1] : 0,
            ap_cost: (effectName in diceMap) ? tierMap[index][2] : 0,
            req_cost: (effectName in diceMap) ? tierMap[index][3] : 0
        };
    }

    function invocationWarning(effect, template, attribute, attr_req, int_req) {
        getAttrs(["ic_ememory", "ic_tmemory",...allAttributes], function(values) {

            let warning = "";
            let warningTemplate = "";
            let warningEffect = "";
            let warningInt = "";
            let warningAttr = "";

            if (!values.ic_tmemory.includes(template)) { 
                warningTemplate = `You do not know ${snakeToTitleCase(template)}\n`;
                warning += "template "
            }
            if (!values.ic_ememory.includes(effect)) { 
                warningEffect = `You do not know ${snakeToTitleCase(effect)}\n`;
                warning += "effect "
            }
            if (parseInt(values[attribute]) < parseInt(attr_req)) { 
                warningAttr = `Your ${attribute} is not high enough\n`;
                warning += "attr "
            }
            if (parseInt(values["Intelligence"]) < parseInt(int_req)) { 
                warningInt = `Your Intelligence is not high enough\n`;
                warning += "int "
            }

            setAttrs({
                ic_warning: warning,
                ic_warning_template: warningTemplate,
                ic_warning_effect: warningEffect,
                ic_warning_attr: warningAttr,
                ic_warning_int: warningInt,
            });
        });
    }

    // generate invocation spell
    on("sheet:opened change:ic_template change:ic_tier change:ic_scaling change:ic_effect " , function() {
        getAttrs(["ic_template","ic_tier","ic_scaling","ic_effect",...allAttributes], function(values) {

            const effect = getEffectDetails(values.ic_effect)
            const template = getTemplateDetails(values.ic_template)
            const tiered = getTieredEffect(values.ic_effect, values.ic_tier)

            let spell_name = snakeToTitleCase(values.ic_template + "_of_" + values.ic_effect)
            spell_name = (tiered.tier) ? spell_name + ` ${tiered.tier}` : spell_name

            const contested = template.contested !== "" ? `\nContested: ${effect.contested}` : "";
            const description = `${template.description.replace("{}", snakeToTitleCase(values.ic_effect))}\n${effect.description}`;
            const descriptionFull = `${description}${contested}\nRange: ${template.range}\nDuration: ${template.duration}`;

            invocationWarning(values.ic_effect, values.ic_template, values.ic_scaling, effect.attr_required + tiered.req_cost, template.int_required);

            setAttrs({
                ic_name: spell_name,
                ic_int_req: template.int_required, 
                ic_attr_req: effect.attr_required + tiered.req_cost, 
                ic_ap: effect.ap_cost + template.ap_cost + tiered.ap_cost, 
                ic_fp: effect.fp_cost + template.fp_cost + tiered.fp_cost, 
                ic_dice: tiered.dice,
                ic_desc_full: descriptionFull,
                ic_range: template.range,
                ic_duration: template.duration,
                ic_cont: effect.contested,
                ic_desc: description,
            });
        });
    });

    // configure attacks
    // also called from invocation save!
    function saveAttacks() {       
        getSectionIDs('repeating_weapons', (w_ids) => {
        getSectionIDs('repeating_rune-spells', (rs_ids) => { 
        getSectionIDs('repeating_ic-saved', (ic_ids) => {
            getAttrs([
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_name`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_acc_bonus`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_dmg_bonus`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_crit_chance`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_scaling`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_ranged`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_dice_one`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_type_one`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_range_one`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_dice_two`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_type_two`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_range_two`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_dice_secondary`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_type_secondary`),
                ...w_ids.map((id) => `repeating_weapons_${id}_weapon_desc`),
                ...rs_ids.map((id) => `repeating_rune-spells_${id}_rs_name`),
                ...rs_ids.map((id) => `repeating_rune-spells_${id}_rs_scaling`),
                ...rs_ids.map((id) => `repeating_rune-spells_${id}_rs_dice`),
                ...rs_ids.map((id) => `repeating_rune-spells_${id}_rs_range`),
                ...rs_ids.map((id) => `repeating_rune-spells_${id}_rs_desc`),
                ...ic_ids.map((id) => `repeating_ic-saved_${id}_ic_name`),
                ...ic_ids.map((id) => `repeating_ic-saved_${id}_ic_scaling`),
                ...ic_ids.map((id) => `repeating_ic-saved_${id}_ic_dice`),
                ...ic_ids.map((id) => `repeating_ic-saved_${id}_ic_range`),
                ...ic_ids.map((id) => `repeating_ic-saved_${id}_ic_desc`),
                ], function(values) {

                let weapons = w_ids.map((id) => ({
                        attack_name: values[`repeating_weapons_${id}_weapon_name`],
                        attack_acc_bonus: (values[`repeating_weapons_${id}_weapon_acc_bonus`] != "0") ? values[`repeating_weapons_${id}_weapon_acc_bonus`] : "",
                        attack_dmg_bonus: (values[`repeating_weapons_${id}_weapon_dmg_bonus`] != "0") ? values[`repeating_weapons_${id}_weapon_dmg_bonus`] : "",
                        attack_crit_chance: values[`repeating_weapons_${id}_weapon_crit_chance`],
                        attack_scaling: values[`repeating_weapons_${id}_weapon_scaling`],
                        attack_dice_one: values[`repeating_weapons_${id}_weapon_dice_one`],
                        attack_type_one: values[`repeating_weapons_${id}_weapon_type_one`],
                        attack_range_one: values[`repeating_weapons_${id}_weapon_range_one`],
                        attack_dice_two: values[`repeating_weapons_${id}_weapon_dice_two`],
                        attack_type_two: values[`repeating_weapons_${id}_weapon_type_two`],
                        attack_range_two: values[`repeating_weapons_${id}_weapon_range_two`],
                        attack_dice_secondary: values[`repeating_weapons_${id}_weapon_dice_secondary`],
                        attack_type_secondary: values[`repeating_weapons_${id}_weapon_type_secondary`],
                        attack_desc: values[`repeating_weapons_${id}_weapon_desc`],
                        attack_ranged: (values[`repeating_weapons_${id}_weapon_ranged`] == "0") ? values[`repeating_weapons_${id}_weapon_ranged`] : "1",
                        attack_one: (values[`repeating_weapons_${id}_weapon_dice_one`] != "") ? "show" : "hide",
                        attack_two: (values[`repeating_weapons_${id}_weapon_dice_two`] != "") ? "show" : "hide",
                        attack_roll_dmg: `&{template:default} {{name=${values[`repeating_weapons_${id}_weapon_name`]}}} `
                }));
                let runes = rs_ids.filter((id) => !!values[`repeating_rune-spells_${id}_rs_dice`]).map((id) => ({
                    attack_name: values[`repeating_rune-spells_${id}_rs_name`],
                    attack_dice_one: values[`repeating_rune-spells_${id}_rs_dice`],
                    attack_scaling: values[`repeating_rune-spells_${id}_rs_scaling`],
                    attack_range: values[`repeating_rune-spells_${id}_rs_range`],
                    attack_spell: "1",
                    attack_one: "show",
                    attack_two: "hide",
                    attack_roll_dmg: `&{template:default} {{name=${values[`repeating_rune-spells_${id}_rs_name`]}}} `
                }));
                let invocations = ic_ids.filter((id) => !!values[`repeating_ic-saved_${id}_ic_dice`]).map((id) => ({
                    attack_name: values[`repeating_ic-saved_${id}_ic_name`],
                    attack_dice_one: values[`repeating_ic-saved_${id}_ic_dice`],
                    attack_scaling: values[`repeating_ic-saved_${id}_ic_scaling`],
                    attack_range: values[`repeating_ic-saved_${id}_ic_range`],
                    attack_spell: "1",
                    attack_one: "show",
                    attack_two: "hide",
                    attack_roll_dmg: `&{template:default} {{name=${values[`repeating_ic-saved_${id}_ic_name`]}}} `,
                }));

                getSectionIDs("repeating_attacks", function(idarray) {
                    for(var i=0; i < idarray.length; i++) {
                        removeRepeatingRow("repeating_attacks_" + idarray[i]);
                    }
                });

                newAttackList = [];
                [...weapons, ...runes, ...invocations].forEach(weapon => {
                    const newRowId = generateRowID();
                    const newAttack = Object.keys(weapon).reduce((item, key) => {
                        item[`repeating_attacks_${newRowId}_${key}`] = weapon[key];
                        return item;
                    }, {});
                    newAttackList.push(newAttack);
                });

                setAttrs(Object.assign({}, ...newAttackList));
            });
        }); 
        }); 
        }); 
    }

    // save attacks
    on('change:repeating_weapons remove:repeating_weapons change:repeating_rune-spells remove:repeating_rune-spells change:repeating_ic-saved remove:repeating_ic-saved', function() {
        saveAttacks();
    });

    // save invocation spell
    on("clicked:ic_save", function() {
        getAttrs(["ic_name", "ic_scaling", "ic_int_req", "ic_attr_req", "ic_ap", "ic_fp", "ic_dice", "ic_range", "ic_duration", "ic_contested", "ic_desc", "ic_desc_full"], function(values) {
            var newrowid = generateRowID();
            const newrowattrs = Object.keys(values).reduce((item, key) => {
                item[`repeating_ic-saved_${newrowid}_${key}`] = values[key];
                return item;
            }, {});

            setAttrs(newrowattrs);
            saveAttacks()
        });
    });

    // general attribute changes
    on("sheet:opened change:xp change:hp_bonus change:vitality_bonus change:fp_bonus change:sp_bonus change:initiative_bonus change:evasion_bonus change:speed_bonus change:equip_load_bonus change:race " + baseEvents, function() {
        getAttrs(["xp","race","hp_bonus","vitality_bonus","fp_bonus","sp_bonus","initiative_bonus","evasion_bonus","speed_bonus","equip_load_bonus",...allAttributes], function(values) {

            function getRaceSpeed(race) {
                const raceValues = {
                    "Dwarf": 10,
                    "Smallfolk": 10,
                    "Turtlefolk": 10,
                    "Felis": 20,
                };
                return raceValues[race] || 15;
            }

            function getAttributeCost(attribute) {
                let attributeLevel = parseInt(attribute);
                if (attributeLevel == 1) {return 0;}
                return attributeLevel/2 * (1 + attributeLevel) - 1;
            }

            function getLevel(xp)
            {
                return Math.floor((parseInt(xp)-100) / 8 + 1);
            }

            const calcHP = 10 + jsSum(values.Vigour, values.Vigour_bonus) * 8 + jsSum(values.Endurance, values.Endurance_bonus, values.Strength);
            const calcVitality = jsSum("1", Math.floor(jsSum(values.Vigour, values.Vigour_bonus) / 2));
            const calcFP = jsSum(values.Intelligence, values.Intelligence_bonus, values.Charisma, values.Charisma_bonus) * 3 + jsSum(values.Perception, values.Perception_bonus, values.Arcana, values.Arcana_bonus, values.Faith, values.Faith_bonus, values.Nature, values.Nature_bonus);
            const calcSP = jsSum(values.Endurance, values.Endurance_bonus);
            const calcInitiative = jsSum(values.Dexterity, values.Dexterity_bonus, values.Perception, values.Perception_bonus);
            const calcEvasion = jsSum(10, jsSum(values.Dexterity, values.Dexterity_bonus) * parseFloat(values.armour_evasion), values.armour_evasion_mod);
            const calcSpeed = jsSum(getRaceSpeed(values.race), Math.floor(jsSum(values.Endurance, values.Endurance_bonus) / 2) * 5, values.armour_speed);
            const calcEquipLoad = jsSum(values.Strength, values.Strength_bonus)
            const calcXpUsed = baseAttributes.reduce((accumulator, attribute) => accumulator + getAttributeCost(values[attribute]), 0);

            saveAttacks();

            setAttrs({
                hp_base: calcHP,
                hp_max: jsSum(calcHP, values.hp_bonus),
                vitality_base: calcVitality,
                vitality_max: jsSum(calcVitality, values.vitality_bonus),
                fp_base: calcFP,
                fp_max: jsSum(calcFP, values.fp_bonus),
                sp_base: calcSP,
                sp_max: jsSum(calcSP, values.sp_bonus),
                initiative_base: calcInitiative,
                initiative_total: jsSum(calcInitiative, values.initiative_bonus),
                evasion_base: calcEvasion,
                evasion_total: jsSum(calcEvasion, values.evasion_bonus),
                speed_base: calcSpeed,
                speed_total: jsSum(calcSpeed, values.speed_bonus),
                level: getLevel(values.xp),
                xp_used: calcXpUsed,
                equip_load_base: calcEquipLoad,
                equip_load_max: jsSum(calcEquipLoad, values.equip_load_bonus),
                ic_spell_memory: jsSum(values.Charisma, values.Charisma_bonus),
                rs_memory: jsSum(values.Intelligence, values.Intelligence_bonus) * 3,
                phys_resist_total: jsSum(values.phys_resist, values.phys_resist_bonus, values.armour_phys),
                mag_resist_total: jsSum(values.mag_resist, values.mag_resist_bonus, values.armour_mag)
            });
        });
    });

// Definitions

const diceMap = {
"fire_damage": ["2d6","4d6","6d6","9d6","12d6"],
"ice_damage": ["1d8","2d8","3d8","5d8","7d8"],
"shadow_damage": ["1d12","2d12","3d12","5d12","7d12"],
"force_damage": ["1d8","2d8","3d8","5d8","7d8"],
"lightning_damage": ["1d10","2d10","3d10","5d10","7d10"],
"poison_damage": ["1d6","2d6","3d6","5d6","7d6"],
"water_damage": ["1d6","2d6","3d6","5d6","7d6"],
};
const tierMap = [
["I", 1, 0, 1],
["II", 2, 1, 3],
["III", 4, 1, 5],
["IV", 6, 2, 8],
["V", 8, 2, 11]
];
const spellEffects = {
"fire_damage": [1, 0, 1, false, "Dexterity", "Disadvantage to Contests against Wet characters."],
"ice_damage": [1, 0, 1, false, "Endurance", "Freezes wet Characters."],
"shadow_damage": [1, 0, 1, false, "Vigour", "Advantage to Attack Rolls and Contests against Characters in Darkness."],
"force_damage": [1, 0, 1, false, "Strength", "Deals 2 x Damage to Structures."],
"lightning_damage": [1, 0, 1, false, "Dexterity", "Advantage to Attack Rolls and Contests against Wet characters."],
"poison_damage": [1, 0, 1, false, "Vigour", "Contest against Target to avoid Poisoning."],
"water_damage": [1, 0, 1, false, "Endurance", "Allies are instead Healed equal to Damage Roll. Characters Damaged or Healed become Wet."],
"dispel": [5, 1, 3, false, "", "This magic unravels all magic it touches.\nDispel 1 in AOE."],
"slow": [3, 1, 1, true, "", "Slows all in range > Halves Base Movement Speed."],
"haste": [3, 1, 4, true, "", "Adds +10ft Base Movement Speed\nOvercharge 2: +5ft Base Movement Speed (Max 3)"],
"freeze": [5, 1, 3, true, "", "Freezes all Wet Characters."],
"resist_fire": [5, 1, 4, true, "", "Resistance to Fire Damage."],
"resist_frost": [5, 1, 4, true, "", "Resistance to Frost Damage + Cannot be Frozen."],
"alarm": [4, 1, 4, true, "", "Caster becomes aware when objects within AoE are moved or touched by another Character."],
"levitation": [5, 2, 6, true, "", "Allows the casters to levitate. \nLevitate – 5ft\nOvercharge 2: +5ft (Max 4)"],
"arcane_flight": [8, 2, 8, true, "", "Fly Speed equal to Movement Speed."],
"charm": [5, 1, 6, true, "Charisma", "Enthrals the target with a mystical mist. "],
"reveal": [6, 1, 5, false, "", "Reveals and Dispels all illusions."],
"arcane_eye": [9, 1, 10, true, "", "30ft Magic Sight"],
"telekinesis": [8, 2, 10, true, "", "Allows the caster to move objects with their mind. "],
"healing_light": [4, 1, 3, false, "", "A golden light cleanses the wounded. Restores 1D10 Hit Points.\nOvercharge 2: +1D10 Healing (Max 6)"],
"terrify": [5, 1, 5, true, "Charisma", "Scary shadows frighten those afflicted."],
"truth": [8, 1, 5, true, "", "Characters within this effect cannot lie. If they attempt to lie, they are Silenced for 1 Minute. If they believe something to be true, then it is not considered a lie by this spell."],
"light": [4, 1, 3, true, "", "A glowing light illuminates the area."],
"darkness": [5, 1, 5, true, "", "Covers the area in thick shadow."],
"resist_lightning": [6, 1, 4, true, "", "Resistance to Lightning Damage."],
"destroy_undead": [5, 1, 2, false, "", "Destroys Level 1 Undead instantly.\nOvercharge 2: +1 Undead Level destroyed (Max 9)"],
"silence": [5, 1, 5, true, "", "All sounds is silenced."],
"celestial_flight": [9, 2, 7, true, "", "Fly Speed equal to Movement Speed."],
"become_incorporeal": [9, 2, 8, false, "", "Characters within the effect take on a ghostly visage, allowing them to move through solid objects."],
"invisibility": [9, 2, 7, true, "", "Bends the light to grant invisibility."],
"ward": [8, 2, 6, true, "", "Choose 1 Creature Type from: Undead, Devil, Demon, Celestial, Aberration. \nTarget Creature Type takes 3D10 Lightning Damage in AoE. \nOvercharge 3: +1 Creature Type (Max 4)"],
"divine_sense": [6, 2, 5, true, "", "Choose 1 Creature Type from: Undead, Devil, Demon, Celestial, Aberration. \nCaster is aware of all creatures of that type in range.\nOvercharge 3: +1 Creature Type (Max 4)"],
"balm_of_nature": [4, 1, 3, false, "", "Restores 1D6 Hit Points\nOverheal\nOvercharge 2: +1D6 Healing (Max 6)"],
"pull": [4, 1, 3, false, "Strength or Dexterity", "Pulls 10ft toward Caster.\nOvercharge 1: +5ft Pull Distance (Max 6)"],
"resist_poison": [5, 1, 4, false, "", "Resistance to Poison Damage.\nCannot be Poisoned."],
"feather_fall": [5, 1, 4, false, "", "Nullifies all Fall Damage. "],
"entangle": [5, 1, 4, false, "Dexterity", "Movement Speed reduced to 0."],
"water_breathing": [5, 1, 1, false, "", "Characters gain Water Breathing"],
"bark_skin": [5, 1, 1, false, "", "Characters gain: \n+5 Physical Armour\n-2 Magical Armour"],
"reinforce_object": [4, 1, 4, false, "", "Objects gains 20 + Nature Hit Points for the duration."],
"mending": [4, 1, 4, false, "", "Object Regains 20 + Nature Hit Points.\nOverheal."],
"eagle's_wings": [7, 2, 7, false, "", "Fly Speed equal to Movement Speed."],
"petrify": [9, 2, 12, false, "Vigour", "Petrifies characters with 0 Hit Points."],
"cleanse": [4, 1, 4, false, "", "A golden light curses an affliction on the target."],
}; 
const spellTemplates = {
"touch": [1, 1, 0, false, "Touch", "Instant", "The caster reaches out and touches the target with {}."],
"dart": [2, 1, 1, false, "30ft", "Instant", "The caster shoots a small burst of {} toward the target."],
"bolt": [4, 1, 3, false, "60ft", "Instant", "The caster shoots a bolt of {} toward their target."],
"orb": [5, 2, 4, false, "40ft", "Instant", "The caster hurls an orb of {} at a target, which then bursts in the area around them."],
"cone": [4, 2, 4, false, "10ft Cone", "Instant", "The caster shoots a cone of {} from their hands and applies the spell effect to the target."],
"rebuttal": [5, 0, 3, false, "60ft", "Instant", "The caster retaliates with a blast of {}."],
"cloud": [4, 2, 4, true, "10x10ft Cloud up to 30ft away", "10 Minutes", "The caster conjures a lingering cloud of {}."],
"buff": [4, 1, 3, true, "30ft", "10 Minutes", "The caster empowers a character within range with {}."],
"enchantment": [4, 1, 3, true, "Touch", "10 Minutes", "The caster empowers an object within range with {}."],
"cloak": [5, 2, 5, true, "Self", "5 Minutes", "The caster surrounds themselves in a small aura of {}."],
"aura": [8, 2, 8, true, "Self", "5 Minutes", "The caster surrounds themselves in a large aura of {}."],
"beam": [8, 2, 8, false, "60ft line", "Instant", "The caster shoots a beam of {} from their hand."],
"wall": [9, 2, 9, true, "60ft line", "10 Minutes", "The caster lifts a wall of {} up from the floor, blocking access to an area."],
"wave": [8, 2, 8, true, "Self", "5 Minutes", "The caster surrounds themselves in a large aura of {} which spreads for the duration."],
"explosion": [9, 2, 9, false, "60ft", "Instant", "The caster chooses a location, and an enormous blast of {} bursts in that spot."],
"glyph": [6, 2, 10, false, "Touch", "Instant", "The caster etches an invisible rune into a location as a trap ready to spring."]
};

const fortunes = [
"Good things come to those who wait.",
"You will have a long and happy life.",
"The best is yet to come.",
"You will find love in unexpected places.",
"Your dreams will come true.",
"Your hard work will pay off.",
"You will be rewarded for your efforts.",
"Opportunities are coming your way.",
"You will be successful in all your endeavors.",
"Good luck will come to you in the future.",
"You will receive good news soon.",
"You will be blessed with good health.",
"Your talents will bring you success.",
"Your creativity will be rewarded.",
"You will find happiness in your career.",
"You will make new friends soon.",
"You will find peace and contentment.",
"Your kindness will be rewarded.",
"Your future is bright.",
"You will have a happy and prosperous life.",
"Misfortune may come your way.",
"Beware of those who seek to deceive you.",
"Your plans may not work out as expected.",
"Your trust may be misplaced.",
"You may face challenges in the near future.",
"Be cautious of those who would do you harm.",
"Your success may be short-lived.",
"Everything will go wrong today.",
"You will regret your decision in the near future.",
"Bad luck and misfortune will follow you all your days.",
"You will face many obstacles and challenges ahead.",
"Your hard work will not pay off in the end.",
"Your plans will fall apart at the last minute.",
"Be prepared for a great disappointment.",
"A major setback is in your future.",
"Things will get worse before they get better.",
"You will lose something valuable to you.",
"Your past will come back to haunt you.",
"You will have a falling out with a close friend.",
"Your future is unclear and uncertain.",
"You will encounter a difficult problem that you cannot solve.",
"Misfortune will follow you wherever you go.",
"Your efforts will be in vain.",
"You will experience a major setback in your career.",
"Your relationships will suffer due to your own actions.",
"Hidden in a valley beside an open stream- This will be the type of place where you will find your dream.",
"A very attractive person has a message for you.",
"You cannot love life until you live the life you love.",
"If you feel you are right, stand firmly by your convictions.",
"Do not mistake temptation for opportunity.",
"He who laughs at himself never runs out of things to laugh at.",
"The greatest risk is not taking one.",
"Serious trouble will bypass you.",
"Help! I am being held prisoner in a fortune cookie factory.",
"A smile is your passport into the hearts of others.",
"Wealth awaits you very soon.",
"Change can hurt, but it leads a path to something better.",
"You will be called in to fulfill a position of high honor and responsibility.",
"Fortune favors the brave.",
"The world may be your oyster, but it doesn't mean you'll get its pearl.",
"Our deeds determine us, as much as we determine our deeds.",
"Actions speak louder than fortune cookies.",
"When fear hurts you, conquer it and defeat it!",
"Now is the time to try something new.",
"Never give up. You're not a failure if you don't give up.",
"Land is always on the mind of a flying bird.",
"A short stranger will soon enter your life with blessings to share.",
"Be on the lookout for coming events; They cast their shadows beforehand.",
"Your shoes will make you happy today.",
"You will be hungry again in one hour.",
"A stranger, is a friend you have not spoken to yet.",
"If you have something good in your life, don't let it go!",
"You will become great if you believe in yourself.",
"Your ability for accomplishment will follow with success.",
"Adversity is the parent of virtue.",
"You will live long enough to open many fortune cookies.",
"Let the deeds speak.",
"A chance meeting opens new doors to success and friendship.",
"Nothing astonishes men so much as common sense and plain dealing.",
"Hard work pays off in the future, laziness pays off now.",
"Meeting adversity well is the source of your strength.",
"People are naturally attracted to you.",
"You are very talented in many ways.",
"You will conquer obstacles to achieve success.",
"It's better to be alone sometimes.",
"The greatest love is self-love.",
"A new voyage will fill your life with untold memories.",
"Fortune not found? Abort, Retry, Ignore.",
"Its amazing how much good you can do if you dont care who gets the credit.",
"A conclusion is simply the place where you got tired of thinking.",
"It is now, and in this world, that we must live.",
"The man or woman you desire feels the same about you.",
"You learn from your mistakes... You will learn a lot today.",
"Everyone agrees. You are the best.",
"Keep your eye out for someone special.",
"Enjoy the good luck a companion brings you.",
"The greatest danger could be your stupidity.",
"LIFE CONSISTS NOT IN HOLDING GOOD CARDS, BUT IN PLAYING THOSE YOU HOLD WELL.",
"The road to riches is paved with homework.",
"Flattery will go far tonight.",
"There is no greater pleasure than seeing your loved ones prosper.",
"If you look back, you'll soon be going that way.",
"You can make your own happiness.",
"Your ability for accomplishment will follow with success.",
"The man on the top of the mountain did not fall there.",
"Joys are often the shadows, cast by sorrows.",
"What ever you're goal is in life, embrace it visualize it, and for it will be yours.",
"The fortune you seek is in another cookie.",
"Love can last a lifetime, if you want it to.",
"Meeting adversity well is the source of your strength.",
"Because of your melodic nature, the moonlight never misses an appointment.",
"If winter comes, can spring be far behind?",
"Don't forget you are always on our minds.",
"A fanatic is one who can't change his mind, and won't change the subject.",
"Jealousy doesn't open doors, it closes them!",
"A dream you have will come true.",
"The love of your life is stepping into your planet this summer.",
"You will travel to many exotic places in your lifetime.",
"You must try, or hate yourself for not trying.",
"A closed mouth gathers no feet.",
"You already know the answer to the questions lingering inside your head.",
"Follow your heart, but take your brain with you.",
"The best things in life are yet to come.",
"Happiness is not something ready made. It comes from your own actions.",
"Believe you can and you're halfway there.",
"The future belongs to those who believe in the beauty of their dreams.",
"Be the change that you wish to see in the world.",
"Success is not final, failure is not fatal: it is the courage to continue that counts.",
"The only way to do great work is to love what you do.",
"Your destiny is in your hands. Create it.",
"Luck is what happens when preparation meets opportunity.",
"The only limit to our realization of tomorrow will be our doubts of today.",
"A journey of a thousand miles begins with a single step.",
"Do not let what you cannot do interfere with what you can do.",
"It does not matter how slowly you go as long as you do not stop.",
"If you want to live a happy life, tie it to a goal, not to people or things.",
"Believe in yourself and all that you are. Know that there is something inside you that is greater than any obstacle.",
"Don't let yesterday take up too much of today.",
"Success is not how high you have climbed, but how you make a positive difference to the world.",
"Your hardest times often lead to the greatest moments of your life. Keep going. Tough situations build strong people in the end.",
"Life is 10% what happens to us and 90% how we react to it.",
"The only person you are destined to become is the person you decide to be."
]
    

</script>

<div class="sheet-section-templates">                           
    <div class="sheet-rolltemplates">
        <rolltemplate class="sheet-rolltemplate-atk">

            <div class="sheet-rt-card">
                <div class="sheet-rt-header{{#weapon}} sheet-weapon{{/weapon}}{{#spell}}  sheet-spell{{/spell}}{{#attribute}} sheet-attribute{{/attribute}}">
                
                    <div class="sheet-rt-title">[{{title}}]({{damage}})</div>

                    {{#charname}}
                    <div class="sheet-rt-subheader">{{charname}} &bullet; Accuracy {{#category}}&bullet; {{category}}{{/category}}</div>
                    {{/charname}}
                </div>

                <div class="sheet-main-content">
                    <div class="result">
                        {{#always}}
                            <div class="adv">
                                <span>{{r1}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}</span>
                            </div>
                        {{/always}}
                        {{#normal}}
                            <div class="solo">
                                <span>{{r1}}</span>
                            </div>
                        {{/normal}}
                        {{#advantage}}
                            {{#rollLess() r1 r2}}
                                <div class="adv">
                                    <span class="grey">{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}</span>
                                </div>
                            {{/rollLess() r1 r2}}
                            {{#rollTotal() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}</span>
                                </div>
                            {{/rollTotal() r1 r2}}
                            {{#rollGreater() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span class="grey">{{r2}}</span>
                                </div>
                            {{/rollGreater() r1 r2}}
                        {{/advantage}}
                        {{#disadvantage}}
                            {{#rollLess() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span class="grey">{{r2}}</span>
                                </div>
                            {{/rollLess() r1 r2}}
                            {{#rollTotal() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}</span>
                                </div>
                            {{/rollTotal() r1 r2}}
                            {{#rollGreater() r1 r2}}
                                <div class="adv">
                                    <span class="grey">{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}</span>
                                </div>
                            {{/rollGreater() r1 r2}}
                        {{/disadvantage}}
                    </div>

                    {{#range}}
                        <div class="sublabel">
                            <span>Range: {{range}}</span>
                        </div>
                    {{/range}}

                </div>
                {{#desc}}
                    <div class="desc info">
                        <span>
                            <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                        </span>
                    </div>
                {{/desc}}
            </div>
        </rolltemplate>


        <rolltemplate class="sheet-rolltemplate-atkdmg">

            <div class="sheet-rt-card">
                <div class="sheet-rt-header{{#weapon}} sheet-weapon{{/weapon}}{{#spell}}  sheet-spell{{/spell}}{{#attribute}} sheet-attribute{{/attribute}}">
                    <div class="sheet-rt-title">{{title}}</div>
                    {{#charname}}
                    <div class="sheet-rt-subheader">{{charname}} &bullet; Accuracy + Damage</div>
                    {{/charname}}
                    {{#category}}
                    <div class="sheet-rt-subheader">{{category}}</div>
                    {{/category}}
                </div>

                <div class="sheet-main-content">
                    {{#attack}}
                        <div class="result">
                            {{#always}}
                                <div class="adv">
                                    <span>{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}</span>
                                </div>
                            {{/always}}
                            {{#normal}}
                                <div class="solo">
                                    <span>{{r1}}</span>
                                </div>
                            {{/normal}}
                            {{#advantage}}
                                {{#rollLess() r1 r2}}
                                    <div class="adv">
                                        <span class="grey">{{r1}}</span>
                                    </div>
                                    <div class="advspacer"></div>
                                    <div class="adv">
                                        <span>{{r2}}</span>
                                    </div>
                                {{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}
                                    <div class="adv">
                                        <span>{{r1}}</span>
                                    </div>
                                    <div class="advspacer"></div>
                                    <div class="adv">
                                        <span>{{r2}}</span>
                                    </div>
                                {{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}
                                    <div class="adv">
                                        <span>{{r1}}</span>
                                    </div>
                                    <div class="advspacer"></div>
                                    <div class="adv">
                                        <span class="grey">{{r2}}</span>
                                    </div>
                                {{/rollGreater() r1 r2}}
                            {{/advantage}}
                            {{#disadvantage}}
                                {{#rollLess() r1 r2}}
                                    <div class="adv">
                                        <span>{{r1}}}</span>
                                    </div>
                                    <div class="advspacer"></div>
                                    <div class="adv">
                                        <span class="grey">{{r2}}}</span>
                                    </div>
                                {{/rollLess() r1 r2}}
                                {{#rollTotal() r1 r2}}
                                    <div class="adv">
                                        <span>{{r1}}}</span>
                                    </div>
                                    <div class="advspacer"></div>
                                    <div class="adv">
                                        <span>{{r2}}}</span>
                                    </div>
                                {{/rollTotal() r1 r2}}
                                {{#rollGreater() r1 r2}}
                                    <div class="adv">
                                        <span class="grey">{{r1}}}</span>
                                    </div>
                                    <div class="advspacer"></div>
                                    <div class="adv">
                                        <span>{{r2}}}</span>
                                    </div>
                                {{/rollGreater() r1 r2}}
                            {{/disadvantage}}
                        </div>

                        {{#range}}
                            <div class="sublabel">
                                <span>Range: {{range}}</span>
                            </div>
                        {{/range}}
                    {{/attack}}

                    {{#desc}}
                        <div class="desc info">
                            <span>
                                <span class="top"></span><span class="middle">{{desc}}</span><span class="bottom"></span>
                            </span>
                        </div>
                    {{/desc}}

                    {{#damage}}
                        <div class="damagetemplate">
                            <div class="result">
                            {{#dmg1flag}}
                                {{^dmg2flag}}
                                    <div class="solo">
                                        <span class="damage">
                                            {{dmg1}}
                                            {{#attack}}
                                                {{#normal}}
                                                    {{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}
                                                {{/normal}}
                                                {{#always}}
                                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                                {{/always}}
                                                {{#advantage}}
                                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                                {{/advantage}}
                                                {{#disadvantage}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{/disadvantage}}
                                            {{/attack}}
                                        </span>  
                                    </div>
                                <span class="sublabel">{{dmg1type}}</span>
                                {{/dmg2flag}}
                            {{/dmg1flag}}
                            {{#dmg2flag}}
                                {{^dmg1flag}}
                                    <div class="solo">
                                        <span class="damage">
                                            {{dmg2}}
                                            {{#attack}}
                                                {{#normal}}
                                                    {{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}
                                                {{/normal}}
                                                {{#always}}
                                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                                {{/always}}
                                                {{#advantage}}
                                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                                {{/advantage}}
                                                {{#disadvantage}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{/disadvantage}}
                                            {{/attack}}
                                        </span>
                                    </div>
                                <span class="sublabel">{{dmg2type}}</span>
                                {{/dmg1flag}}
                            {{/dmg2flag}}
                            {{#dmg1flag}}
                                {{#dmg2flag}}
                                    <div class="adv">
                                        <span class="damage">
                                            {{dmg1}}
                                            {{#attack}}
                                                {{#normal}}
                                                    {{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}
                                                {{/normal}}
                                                {{#always}}
                                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                                {{/always}}
                                                {{#advantage}}
                                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit1}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                                {{/advantage}}
                                                {{#disadvantage}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit1}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{/disadvantage}}
                                            {{/attack}}
                                        </span>
                                <span class="sublabel">{{dmg1type}}</span>
                                </div>
                                <div class="advspacer"></div>
                                    <div class="adv">
                                        <span class="damage">
                                            {{dmg2}}
                                            {{#attack}}
                                                {{#normal}}
                                                    {{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}
                                                {{/normal}}
                                                {{#always}}
                                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                                {{/always}}
                                                {{#advantage}}
                                                    {{#rollLess() r1 r2}}{{#rollWasCrit() r2}}+ {{crit2}}{{/rollWasCrit() r2}}{{/rollLess() r1 r2}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                    {{#rollGreater() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollGreater() r1 r2}}
                                                {{/advantage}}
                                                {{#disadvantage}}
                                                    {{#rollTotal() r1 r2}}{{#rollWasCrit() r1}}+ {{crit2}}{{/rollWasCrit() r1}}{{/rollTotal() r1 r2}}
                                                {{/disadvantage}}
                                            {{/attack}}
                                        </span>
                                <span class="sublabel">{{dmg2type}}</span>
                                </div>
                                {{/dmg2flag}}
                            {{/dmg1flag}}
                        </div>
                        </div> 
                    {{/damage}}
                </div>    
            </div>
        </rolltemplate>


        <rolltemplate class="sheet-rolltemplate-dmg">
            <div class="sheet-rt-card">
            <div class="damagetemplate">
                <div class="result">
                    {{#dmg1flag}}
                        {{^dmg2flag}}
                            <div class="solo">
                                <span class="damage">{{dmg1}}{{#crit}} + {{crit1}}{{/crit}}</span>
                                <span class="sublabel">{{dmg1type}}</span>
                            </div>
                        {{/dmg2flag}}
                    {{/dmg1flag}}
                    {{#dmg2flag}}
                        {{^dmg1flag}}
                            <div class="solo">
                                <span class="damage">{{dmg2}}{{#crit}} + {{crit2}}{{/crit}}</span>
                                <span class="sublabel">{{dmg2type}}</span>
                            </div>
                        {{/dmg1flag}}
                    {{/dmg2flag}}
                    {{#dmg1flag}}
                        {{#dmg2flag}}
                            <div class="adv">
                                <span class="damage">{{dmg1}}{{#crit}} + {{crit1}}{{/crit}}</span>
                                <span class="sublabel">{{dmg1type}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span class="damage">{{dmg2}}{{#crit}} + {{crit2}}{{/crit}}</span>
                                <span class="sublabel">{{dmg2type}}</span>
                            </div>
                        {{/dmg2flag}}
                    {{/dmg1flag}}
                </div>
            </div>
            </div>
        </rolltemplate>


        <rolltemplate class="sheet-rolltemplate-simple">
            <div class="sheet-rt-card">
                <div class="sheet-rt-header{{#weapon}} sheet-weapon{{/weapon}}{{#spell}}  sheet-spell{{/spell}}{{#attribute}} sheet-attribute{{/attribute}}">
                    <div class="sheet-rt-title">{{title}}</div>
                
                    {{#charname}}
                    <div class="sheet-rt-subheader">{{charname}}{{#type}} &bullet; {{type}}{{/type}}{{#category}} &bullet; {{category}}{{/category}}</div>
                    {{/charname}}
                </div>

                <div class="sheet-main-content">
                    <div class="result">
                        {{#always}}
                            <div class="adv">
                                <span>{{r1}}</span>
                            </div>
                            <div class="advspacer"></div>
                            <div class="adv">
                                <span>{{r2}}</span>
                            </div>
                        {{/always}}
                        {{#normal}}
                            <div class="solo">
                                <span>{{r1}}</span>
                            </div>
                        {{/normal}}
                        {{#advantage}}
                            {{#rollLess() r1 r2}}
                                <div class="adv">
                                    <span class="grey">{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}</span>
                                </div>
                            {{/rollLess() r1 r2}}
                            {{#rollTotal() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}</span>
                                </div>
                            {{/rollTotal() r1 r2}}
                            {{#rollGreater() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span class="grey">{{r2}}</span>
                                </div>
                            {{/rollGreater() r1 r2}}
                        {{/advantage}}
                        {{#disadvantage}}
                            {{#rollLess() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span class="grey">{{r2}}</span>
                                </div>
                            {{/rollLess() r1 r2}}
                            {{#rollTotal() r1 r2}}
                                <div class="adv">
                                    <span>{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}</span>
                                </div>
                            {{/rollTotal() r1 r2}}
                            {{#rollGreater() r1 r2}}
                                <div class="adv">
                                    <span class="grey">{{r1}}</span>
                                </div>
                                <div class="advspacer"></div>
                                <div class="adv">
                                    <span>{{r2}}</span>
                                </div>
                            {{/rollGreater() r1 r2}}
                        {{/disadvantage}}
                    </div>
                </div>
            </div>
        </rolltemplate>


        <rolltemplate class="sheet-rolltemplate-desc">
            <div class="sheet-rt-card">
                 <div class="sheet-rt-header{{#weapon}} sheet-weapon{{/weapon}}{{#spell}}  sheet-spell{{/spell}}{{#attribute}} sheet-attribute{{/attribute}}">
                    <div class="sheet-rt-title">{{title}}</div>
                    {{#charname}}
                    <div class="sheet-rt-subheader">{{charname}} {{#type}}&bullet; {{type}}{{/type}} {{#school}}&bullet; {{school}}{{/school}}</div>
                    {{/charname}}
                </div>

                <div class="sheet-main-content">
                    <div class="container">
                        {{#range}}
                            <div class="spacer"></div>
                            <div class="row">
                                <span class="bold">Range:</span> <span>{{range}}</span>
                            </div>
                        {{/range}}
                        {{#target}}
                            <div class="row">
                                <span class="bold">Target:</span> <span>{{target}}</span>
                            </div>
                        {{/target}}
                        {{#duration}}
                            <div class="row">
                                <span class="bold">Duration:</span> <span>{{#concentration}}<span>Concentration</span> {{/concentration}}{{duration}}</span>
                            </div>
                            <div class="spacer"></div>
                        {{/duration}}
                        {{#desc}}
                            <div class="row">
                                <span class="description">{{desc}}</span>
                            </div>
                        {{/desc}}
                        {{#overcharge}}
                            <div class="spacer"></div>
                            <div class="row">
                                <span class="bold italics">Overcharge:</span>. <span class="description">{{overcharge}}</span>
                            </div>
                        {{/overcharge}}
                    </div>
                </div>
            </div>
        </rolltemplate>
    </div>
</div>